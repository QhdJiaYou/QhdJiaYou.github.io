<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <title>
    
    Hexo
  </title>
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <main class="content">
    <section class="jumbotron">
  <div class="video">
    
    <div class="video-frame">
      <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
    </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay="" poster="/images/ocean/ocean.png"
        x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">Hexo</a></h1>
      <p></p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="Hexo"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>
<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>
    
    
    <article id="post-Mac下配置多个SSHKey" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2023/12/07/Mac%E4%B8%8B%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AASSHKey/">Mac下配置多个SSHKey</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2023/12/07/Mac%E4%B8%8B%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AASSHKey/" class="article-date">
  <time datetime="2023-12-07T03:25:09.000Z" itemprop="datePublished">2023-12-07</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>大家在工作中可能会遇到需要在一台电脑上配置不同的 SSH Key 的情况，例如我们需要同时使用个人 Github 以及公司的 Gitlab 情况，这时我们就需要配置不同的 SSH Key 了。具体操作步骤如下:</p>
<h4 id="打开终端，切换到系统的-SSH-目录下"><a href="#打开终端，切换到系统的-SSH-目录下" class="headerlink" title="打开终端，切换到系统的 SSH 目录下"></a>打开终端，切换到系统的 SSH 目录下</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br></pre></td></tr></table></figure>

<h4 id="查看当前的-SSH-Key"><a href="#查看当前的-SSH-Key" class="headerlink" title="查看当前的 SSH Key"></a>查看当前的 SSH Key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al</span><br></pre></td></tr></table></figure>

<h4 id="移除所有的公钥"><a href="#移除所有的公钥" class="headerlink" title="移除所有的公钥"></a>移除所有的公钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm id_rsa*</span><br></pre></td></tr></table></figure>

<h4 id="生成自己Github的SSH-Key"><a href="#生成自己Github的SSH-Key" class="headerlink" title="生成自己Github的SSH Key"></a>生成自己Github的SSH Key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;自己的Github账号&quot;</span> -f github_rsa</span><br></pre></td></tr></table></figure>

<h4 id="生成公司Github的SSH-Key"><a href="#生成公司Github的SSH-Key" class="headerlink" title="生成公司Github的SSH Key"></a>生成公司Github的SSH Key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;公司的Github账号&quot;</span> -f company_rsa</span><br></pre></td></tr></table></figure>

<h4 id="获取SSH公钥粘贴到对应平台的SSH设置中"><a href="#获取SSH公钥粘贴到对应平台的SSH设置中" class="headerlink" title="获取SSH公钥粘贴到对应平台的SSH设置中"></a>获取SSH公钥粘贴到对应平台的SSH设置中</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.ssh/company_rsa.pub</span><br><span class="line">cat ~/.ssh/github_rsa.pub</span><br></pre></td></tr></table></figure>

<h4 id="添加配置文件-config"><a href="#添加配置文件-config" class="headerlink" title="添加配置文件 config"></a>添加配置文件 config</h4><p>如果有则直接编辑，没有则创建，路径 ~/.ssh/config，配置写法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># github</span></span><br><span class="line">Host github.com</span><br><span class="line">HostName github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/github_rsa</span><br><span class="line"></span><br><span class="line"><span class="comment"># gitlab</span></span><br><span class="line">Host gitlab.com</span><br><span class="line">HostName gitlab.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/company_rsa</span><br></pre></td></tr></table></figure>

<p>Host 名称可以随便设置，HostName 就是网站的地址</p>
<h4 id="测试下是否添加成功"><a href="#测试下是否添加成功" class="headerlink" title="测试下是否添加成功"></a>测试下是否添加成功</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试 GitHub</span></span><br><span class="line"></span><br><span class="line">ssh -T git@github.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试 GitLab</span></span><br><span class="line"></span><br><span class="line">ssh -T git@gitlab.com</span><br></pre></td></tr></table></figure>

<h4 id="不同项目切换不同的SSH"><a href="#不同项目切换不同的SSH" class="headerlink" title="不同项目切换不同的SSH"></a>不同项目切换不同的SSH</h4><p>为了方便同时使用多个账号，我们可以通过文件路径进行区分<br>首先为自己的github账号创建.gitconfig-my配置文件，内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">    name = 自己的Github账号</span><br><span class="line">    email = 自己的Github邮箱</span><br></pre></td></tr></table></figure>

<p>修改全局git config文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.gitconfig</span><br></pre></td></tr></table></figure>

<p>添加如下配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[user]</span><br><span class="line">    name = 公司账号</span><br><span class="line">    email = 公司邮箱</span><br><span class="line">[includeIf <span class="string">&quot;gitdir:~/MYGITHUB/&quot;</span>]</span><br><span class="line">    path = .gitconfig-my</span><br></pre></td></tr></table></figure>

<p>这样指定目录～/MYGITHUB/下的文件就会使用自己的github账号和邮箱，而其他目录仍然使用全局配置公司的邮箱和账号</p>
<p>以上就是在Mac下配置多个SSHKey的具体步骤，希望对你有所帮助。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2023/12/07/Mac%E4%B8%8B%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AASSHKey/" data-id="clpuo0yv80004otmu3pq550jm" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-执行上下文、作用域、this指向" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2022/08/06/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81this%E6%8C%87%E5%90%91/">执行上下文、作用域、this指向</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2022/08/06/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81this%E6%8C%87%E5%90%91/" class="article-date">
  <time datetime="2022-08-06T09:50:43.000Z" itemprop="datePublished">2022-08-06</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <p>详细了解执行上下文极为重要，因为其中涉及到了变量对象，作用域链，this等极为重要的概念，它关系到我们能不能真正理解JavaScript，下面我们分别了解几个概念。</p>
<h3 id="执行上下文概念"><a href="#执行上下文概念" class="headerlink" title="执行上下文概念"></a>执行上下文概念</h3><p>执行上下文是指<span style="color:blue;">函数调用时</span>在<span style="color:blue;">执行栈中</span>产生的<span style="color:blue;">当前函数(或全局对象window)</span>的执行环境，该环境如隔绝外部世界的容器边界，保管可访问的变量、this对象等。</p>
<p>“执行上下文”就是当前 JS 代码被解析和执行时所处环境的抽象概念，JS 中任何代码都是在“执行上下文”中运行的。</p>
<p>当函数在执行的前一刻，会创建一个称为执行期上下文的内部对象，一个执行期上下文定义了一个函数执行时的环境，函数每次执行时对应的执行上下文都是独一无二的，所以多次调用一个函数会导致创建多个执行上下文，当函数执行完毕时，执行上下文就会被销毁。</p>
<h3 id="执行上下文栈"><a href="#执行上下文栈" class="headerlink" title="执行上下文栈"></a>执行上下文栈</h3><p>全局上下文在代码开始执行时就创建，只有唯一的一个，永远在栈底，浏览器窗口关闭时出栈。</p>
<p>函数被调用的时候创建自己的上下文环境。</p>
<p>只有栈顶的上下文处于活动状态，执行其中的代码。</p>
<p>ES5中外层var和函数声明，默认绑定到顶层对象上，ES6新增的const和let，在最外层声明的变量不会绑定到顶层对象</p>
<h3 id="执行期上下文的生命周期"><a href="#执行期上下文的生命周期" class="headerlink" title="执行期上下文的生命周期"></a>执行期上下文的生命周期</h3><h4 id="1、创建阶段"><a href="#1、创建阶段" class="headerlink" title="1、创建阶段"></a>1、创建阶段</h4><p>在这个阶段中，执行上下文会分别<span style="color:blue;">创建变量对象，建立作用域链，确定this指向</span>。</p>
<p>变量对象的创建过程</p>
<p>(1)<strong>建立arguments对象</strong>。检查当前上下文中的参数，建立该对象下的属性与属性值。</p>
<p>(2)<strong>检查当前上下文的函数声明</strong>，也就是使用function关键字声明的函数。在变量对象中以函数名建立一个属性，属性值为指向该函数所在内存地址的引用。如果函数名的属性已经存在，那么该属性将会被新的引用所覆盖。</p>
<p>(3)<strong>检查当前上下文中的变量声明</strong>，每找到一个变量声明，就在变量对象中以变量名建立一个属性，属性值为undefined,如果变量名的属性已经存在，为了防止同名的函数被修改为undefined,则会直接跳过，原属性值不会被修改。</p>
<h4 id="2、执行阶段"><a href="#2、执行阶段" class="headerlink" title="2、执行阶段"></a>2、执行阶段</h4><p>当开始执行代码的时候，会在这个阶段完成<span style="color:blue;">变量的赋值，函数的引用，以及执行其他的代码</span>。</p>
<p>下面我们结合实际case进行分析</p>
<p>例子1:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(foo); <span class="comment">// [Function: foo] node执行结果</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;function&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> foo=<span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(foo); <span class="comment">//foo</span></span><br></pre></td></tr></table></figure>
<p>变量对象创建过程，重名的变量定义直接跳过</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">testEC=&#123;</span><br><span class="line">  <span class="comment">//VO为Variables Object的缩写，即变量对象</span></span><br><span class="line">  <span class="attr">VO</span>:&#123;</span><br><span class="line">    <span class="attr">arguments</span>:&#123;...&#125;,</span><br><span class="line">    <span class="attr">foo</span>:<span class="number">0xa00</span>, <span class="comment">//指向foo函数的内存地址， 同名变量被跳过</span></span><br><span class="line">    <span class="attr">this</span>:Window</span><br><span class="line">  &#125;,</span><br><span class="line"> <span class="attr">scopeChain</span>:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行过程中，foo被赋值为’foo’字符串</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 变量对象 -&gt; 活动对象</span></span><br><span class="line">VO-&gt;AO <span class="comment">//Active Object</span></span><br><span class="line">AO=&#123;</span><br><span class="line">  <span class="attr">arguments</span>:&#123;...&#125;,</span><br><span class="line">  <span class="attr">foo</span>:<span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">  <span class="attr">this</span>:Window</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以整个执行过程如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123; <span class="comment">// 创建过程</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;function&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(foo); <span class="comment">// [Function: foo] node执行结果</span></span><br><span class="line">foo=<span class="string">&#x27;foo&#x27;</span>; <span class="comment">// 执行过程被赋值</span></span><br><span class="line"><span class="built_in">console</span>.log(foo); <span class="comment">//foo</span></span><br></pre></td></tr></table></figure>

<p>例子2:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a);<span class="comment">//undefined</span></span><br><span class="line">  <span class="built_in">console</span>.log(foo());<span class="comment">//2</span></span><br><span class="line">  <span class="keyword">var</span> a=<span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure>
<p>创建过程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">testEC=&#123;</span><br><span class="line">  <span class="comment">//VO为Variables Object的缩写，即变量对象</span></span><br><span class="line">  <span class="attr">VO</span>:&#123;</span><br><span class="line">    <span class="attr">arguments</span>:&#123;...&#125;,</span><br><span class="line">    <span class="attr">foo</span>:<span class="number">0xa00</span>,<span class="comment">//指向foo函数的内存地址</span></span><br><span class="line">    <span class="attr">a</span>:<span class="literal">undefined</span>,</span><br><span class="line">    <span class="attr">this</span>:Window</span><br><span class="line">  &#125;,</span><br><span class="line"> <span class="attr">scopeChain</span>:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行阶段：未进入执行阶段之前，变量对象中的属性都不能访问！但是进入执行阶段之后，变量对象转变为了活动对象，里面的属性都能被访问了，然后开始进行执行的操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VO-&gt;AO//Active Object</span></span><br><span class="line">AO=&#123;</span><br><span class="line">  <span class="attr">arguments</span>:&#123;...&#125;,</span><br><span class="line">  <span class="attr">foo</span>:<span class="number">0xa00</span>,</span><br><span class="line">  <span class="attr">a</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="attr">this</span>:Window</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，上面例子的执行顺序如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> a;</span><br><span class="line">  <span class="built_in">console</span>.log(a);<span class="comment">//undefined</span></span><br><span class="line">  <span class="built_in">console</span>.log(foo());<span class="comment">//2</span></span><br><span class="line">  a=<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure>

<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>就是<span style="color:blue;">变量</span>和<span style="color:blue;">函数</span>可访问的范围，即作用域控制着<span style="color:blue;">变量</span>和<span style="color:blue;">函数</span>的<span style="color:blue;">可见性</span>和<span style="color:blue;">生命周期</span></p>
<h3 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h3><p>需要的变量在当前作用域找不到的时候，会一层一层向上查找，直到全局作用域还没有找到的时候，就会放弃查找</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>当函数可以记住并访问所在的词法作用域时，就产生了闭包。即使函数是在当前词法作用域之外执行。</p>
<h4 id="1、闭包形成的条件"><a href="#1、闭包形成的条件" class="headerlink" title="1、闭包形成的条件"></a>1、闭包形成的条件</h4><p>1、函数嵌套</p>
<p>2、内部函数引用外部函数的局部变量</p>
<h4 id="2、闭包的作用"><a href="#2、闭包的作用" class="headerlink" title="2、闭包的作用"></a>2、闭包的作用</h4><p>可以读取函数内部的变量</p>
<p>可以使变量的值长期保存在内存中，生命周期比较长。</p>
<p>可用来实现JS模块（JQuery库等），JS模块是具有特定功能的JS文件，将所有的数据和功能都封装在一个函数内部(私有的)，只向外暴露一个包含多个方法的对象或函数，模块的使用者，只需要通过模块暴露的对象调用方法来实现对应的功能。</p>
<h3 id="this指向"><a href="#this指向" class="headerlink" title="this指向"></a>this指向</h3><h4 id="1、普通函数中this"><a href="#1、普通函数中this" class="headerlink" title="1、普通函数中this"></a>1、普通函数中this</h4><p>总是代表着它的直接调用者，如obj.fn，fn里的最外层this就是指向obj</p>
<p>默认情况下，没有直接调用者，this指向window</p>
<p>严格模式下（设置了’use strict’），this为undefined</p>
<p>当使用call，apply，bind（ES5新增）绑定的，this指向绑定对象</p>
<h4 id="2、ES6箭头函数指向"><a href="#2、ES6箭头函数指向" class="headerlink" title="2、ES6箭头函数指向"></a>2、ES6箭头函数指向</h4><p>更短的函数，相当于匿名函数，简化了函数的定义</p>
<p>（1）默认指向定义它时，所处上下文的对象的this指向。即ES6箭头函数里this的指向就是上下文里对象this指向，偶尔没有上下文对象，this就指向window</p>
<p>（2）即使是call，apply，bind等方法也不能改变箭头函数this的指向</p>
<p><strong>实际case</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">radius</span>: <span class="number">10</span>,  </span><br><span class="line">  <span class="function"><span class="title">diameter</span>(<span class="params"></span>)</span> &#123;    </span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.radius * <span class="number">2</span></span><br><span class="line">  &#125;,  </span><br><span class="line">  <span class="attr">perimeter</span>: <span class="function">() =&gt;</span> <span class="number">2</span> * <span class="built_in">Math</span>.PI * <span class="built_in">this</span>.radius <span class="comment">// 所处的上下文环境是全局上下文， Window对象上没有radius变量</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.diameter())    <span class="comment">// 20</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.perimeter())    <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>

<p>参考文档</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7194742747427766309">JS执行上下文</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904068888920071">作用域</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7043740640420560910">this指向</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/08/06/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81this%E6%8C%87%E5%90%91/" data-id="clpuo0yvi000gotmu6x9n0s58" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-README" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2022/07/01/README/">个人介绍</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2022/07/01/README/" class="article-date">
  <time datetime="2022-07-01T09:50:43.000Z" itemprop="datePublished">2022-07-01</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="曲晗东-前端开发工程师"><a href="#曲晗东-前端开发工程师" class="headerlink" title="曲晗东 - 前端开发工程师"></a>曲晗东 - 前端开发工程师</h2><div>
<image src="https://github.com/QhdJiaYou/Image/blob/master/me.jpg?raw=true" style="height: 150px; float:right"/>

<ul>
<li><p>个人信息：女｜北京｜1995.02</p>
</li>
<li><p>联系方式：17822001400 ｜ <a href="mailto:&#x71;&#x75;&#104;&#x61;&#x6e;&#100;&#x6f;&#110;&#103;&#64;&#x74;&#x6a;&#117;&#x2e;&#101;&#100;&#x75;&#46;&#x63;&#110;">&#x71;&#x75;&#104;&#x61;&#x6e;&#100;&#x6f;&#110;&#103;&#64;&#x74;&#x6a;&#117;&#x2e;&#101;&#100;&#x75;&#46;&#x63;&#110;</a> </p>
</li>
<li><p>个人博客：<a target="_blank" rel="noopener" href="https://qhdjiayou.github.io/">https://qhdjiayou.github.io</a></p>
</li>
<li><p>工作年限：3年</p>
</li>
</ul>
<div>

<div style="clear: both;"><div>
<style>
table {
    width: 100%;
}
</style>

<h2 id="教育经历"><a href="#教育经历" class="headerlink" title="教育经历"></a>教育经历</h2><table>
<thead>
<tr>
<th>大学</th>
<th>专业</th>
<th>学历</th>
<th>时间</th>
</tr>
</thead>
<tbody><tr>
<td>天津大学</td>
<td>软件工程</td>
<td>硕士</td>
<td>2017.09 - 2020.01</td>
</tr>
<tr>
<td>南京理工大学</td>
<td>软件工程</td>
<td>本科</td>
<td>2013.09 - 2017.06</td>
</tr>
</tbody></table>
<h2 id="工作经历"><a href="#工作经历" class="headerlink" title="工作经历"></a>工作经历</h2><h3 id="美团-—-前端开发工程师-—-2020-2-至今"><a href="#美团-—-前端开发工程师-—-2020-2-至今" class="headerlink" title="美团 — 前端开发工程师 — 2020.2~至今"></a>美团 — 前端开发工程师 — 2020.2~至今</h3><p><code>Flutter</code> <code>React Native</code>  <code>React</code> <code>Vue</code> <code>TS</code></p>
<h4 id="RooFlutter组件库建设-（主R）"><a href="#RooFlutter组件库建设-（主R）" class="headerlink" title="RooFlutter组件库建设 （主R）"></a>RooFlutter组件库建设 （主R）</h4><ul>
<li>在FFW(Flutter For Web)双端适配需求落地过程中，克服时间紧任务重、组件库历史包袱多等各种问题，不到一个月的时间完成<strong>18个高优组件</strong>双端适配开发，后续经过<strong>5个版本</strong>的迭代优化，目前累计完成<strong>24个</strong>双端适配组件，应用到<strong>7个业务</strong>，<strong>11个git工程</strong>中。</li>
</ul>
<h4 id="H5多活动工程化套件设计和开发（主R）"><a href="#H5多活动工程化套件设计和开发（主R）" class="headerlink" title="H5多活动工程化套件设计和开发（主R）"></a>H5多活动工程化套件设计和开发（主R）</h4><ul>
<li>因组内维护较多小的H5营销活动项目，为了提升开发体验和效率，该套件在单位适配（vw/vh或rem）、性能优化（service worker支持、图片压缩/转webp）、通用模块（组件、方法）等方向上, 针对每个活动项目，提供动态化配置，各活动编译、打包隔离。目前组内<strong>10+活动项目</strong>都已使用该套件规范，并被nine收录到精品套件推广位。</li>
</ul>
<h4 id="TS规范建设与推广（主R）"><a href="#TS规范建设与推广（主R）" class="headerlink" title="TS规范建设与推广（主R）"></a>TS规范建设与推广（主R）</h4><ul>
<li>业务迁移React技术栈过程中，因缺少类型声明规范、出现大量不规范写法，甚至有语法滥用的情况，为了增强代码的健壮性和可维护性，积极调研并在组内制定了TS基本书写规范以及基本tsconfig和eslintrc的配置，开发了针对TS语法校验的eslint插件，同时通过在组内组织多次分享进行推广，目前该规范内容已在组内<strong>70%项目</strong>中落地使用。</li>
</ul>
<h4 id="财务对账、发票系统业务（主R）"><a href="#财务对账、发票系统业务（主R）" class="headerlink" title="财务对账、发票系统业务（主R）"></a>财务对账、发票系统业务（主R）</h4><ul>
<li>该业务特点：<strong>多平台</strong>(PC、App)、<strong>多技术栈</strong>（Vue、React、Flutter）、<strong>多工程</strong>（累计10+git 工程）、<strong>多业务方</strong>（外卖、闪购、先富、蜜蜂），主R期间，由于PC端技术栈陈旧，发起并完成了PC财务对账系统重构，使用Flutter技术栈实现了一套代码PC-App双端复用，提升了开发效率和维护成本，更新了陈旧交互样式，提升了用户体验。</li>
</ul>
<h4 id="经营分析、规则中心业务（主R）"><a href="#经营分析、规则中心业务（主R）" class="headerlink" title="经营分析、规则中心业务（主R）"></a>经营分析、规则中心业务（主R）</h4><ul>
<li>负责<strong>多平台</strong>(商家中心PC、App)、<strong>多技术栈</strong>（RN、React、Flutter）的商家端经营分析业务，主R期间，使用RN完成App端业务重构，完成了PC端多个模块的重构和改版需求。</li>
</ul>
<h2 id="技能特长"><a href="#技能特长" class="headerlink" title="技能特长"></a>技能特长</h2><ul>
<li><p>专业技能 ：</p>
</li>
<li><p>熟练使用HTML5/CSS3/JavaScript/Dart等语言，理解JS的面向对象编程思想；</p>
</li>
<li><p>熟悉ES6/ES7语法新特性，熟悉webpack打包工具、了解Babel、Sass等编译器；</p>
</li>
<li><p>掌握前端框架：React、Flutter、Vue， 有React、Flutter大型项目开发经验；</p>
</li>
<li><p>个人素质：</p>
<ul>
<li>学习能力强，做事认真，主动解决问题，善于沟通。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/07/01/README/" data-id="clpuo0yv90005otmufj59he2d" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-flutter实现跟随效果" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2022/06/06/flutter%E5%AE%9E%E7%8E%B0%E8%B7%9F%E9%9A%8F%E6%95%88%E6%9E%9C/">flutter跟随</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2022/06/06/flutter%E5%AE%9E%E7%8E%B0%E8%B7%9F%E9%9A%8F%E6%95%88%E6%9E%9C/" class="article-date">
  <time datetime="2022-06-06T09:50:43.000Z" itemprop="datePublished">2022-06-06</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h3 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h3><p>PC上ToolTip组件、Selector组件、Cascade组件、以及时间选择组件等等，在App上需要弹出展示的情况，大多数情况下，在PC上的交互是跟随弹出。</p>
<h3 id="二、ToolTip难以胜任"><a href="#二、ToolTip难以胜任" class="headerlink" title="二、ToolTip难以胜任"></a>二、ToolTip难以胜任</h3><p>但是目前flutter原生的ToolTip组件对外暴露参数有限，且很难扩展使用，举一个最难接受的就是，弹出内容无法直接限制宽度，如果不做限制，会用页面最大宽度展示。</p>
<p>此外，弹出内容只能传字符串类型，无法自定义Widget，这也就导致很难画出PC toolTip上的三角形效果(也可以直接修改源码, 通过定位添加三角形)，更不能定制Widget展示，难以实现Selector、Cascade等带有交互的复杂组件。</p>
<p>如果是只是简单实现ToolTip效果，不在乎太多样式，倒是有解决办法，手动在字符串中拼接”\n”字符， 外部通过传递参数<strong>lineWordCount</strong>设置一行容纳的字符个数，以此解决宽度问题，下面是封装好的ToolTip组件。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToolTipNew</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ToolTipNew(&#123;</span><br><span class="line">    <span class="keyword">this</span>.key,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.target,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.tip,</span><br><span class="line">    <span class="keyword">this</span>.width,</span><br><span class="line">    <span class="keyword">this</span>.height,</span><br><span class="line">    <span class="keyword">this</span>.onClick,</span><br><span class="line">    <span class="keyword">this</span>.lineWordCount = <span class="number">30</span>,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> Key key;</span><br><span class="line">  <span class="keyword">final</span> Widget target;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> tip;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> width;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> height;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Function</span> onClick;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">每一行字符数量</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> lineWordCount;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> generateMessage(<span class="built_in">String</span> str) &#123;</span><br><span class="line">    <span class="built_in">String</span> newLabel = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="built_in">int</span> totalLen = str.length;</span><br><span class="line">    <span class="keyword">if</span> (totalLen &lt;= lineWordCount) &#123;</span><br><span class="line">      newLabel = str;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">int</span> lines = totalLen ~/ lineWordCount;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;= lines; i++) &#123;</span><br><span class="line">        newLabel += (str.substring(</span><br><span class="line">                lineWordCount * i, min(lineWordCount * (i + <span class="number">1</span>), totalLen)) +</span><br><span class="line">            ((i == lines) ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27;\n&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newLabel;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> UITools.isPc</span><br><span class="line">        ? Material(</span><br><span class="line">            child: Container(</span><br><span class="line">              color: Colors.white,</span><br><span class="line">              width: width ?? <span class="number">100</span>,</span><br><span class="line">              height: height ?? <span class="number">36</span>,</span><br><span class="line">              child: Center(</span><br><span class="line">                child: Tooltip(</span><br><span class="line">                  verticalOffset: <span class="number">10</span>,</span><br><span class="line">                  message: generateMessage(tip),</span><br><span class="line">                  padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12</span>),</span><br><span class="line">                  decoration: BoxDecoration(</span><br><span class="line">                      color: Color(<span class="number">0xFF3f4156</span>),</span><br><span class="line">                      borderRadius: BorderRadius.circular(<span class="number">2</span>)),</span><br><span class="line">                  textStyle: TextStyle(</span><br><span class="line">                    decoration: TextDecoration.none,</span><br><span class="line">                    fontSize: <span class="number">14</span>,</span><br><span class="line">                    color: Colors.white,</span><br><span class="line">                  ),</span><br><span class="line">                  child: target,</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          )</span><br><span class="line">        : GestureDetector(</span><br><span class="line">            child: target,</span><br><span class="line">            onTap: onClick ?? () &#123;&#125;,</span><br><span class="line">          );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果为了追求更好的交互样式效果，我们还是另寻别的出路，比较好。</p>
<h3 id="三、Overlay配合伴随组件实现Follower组件"><a href="#三、Overlay配合伴随组件实现Follower组件" class="headerlink" title="三、Overlay配合伴随组件实现Follower组件"></a>三、Overlay配合伴随组件实现Follower组件</h3><ol>
<li>使用overlay</li>
<li>CompositedTransformTarget和CompositedTransformFollower</li>
</ol>
<p>完整封装follower.dart</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> DirectionTypeVertical &#123;</span><br><span class="line">  top,</span><br><span class="line">  bottom,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> DirectionTypeHorizontal &#123;</span><br><span class="line">  left,</span><br><span class="line">  right,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">double</span> defaultModalHeight = <span class="number">180</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">double</span> shadowWidth = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">const</span> Color borderDefaultColor = Color(<span class="number">0xFFE9EAF2</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EolFollowerWidget</span> </span>&#123;</span><br><span class="line">  OverlayEntry _overlayEntry;</span><br><span class="line">  GlobalKey _gkey = GlobalKey();</span><br><span class="line">  LayerLink _layerLink = LayerLink();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">取消</span></span></span><br><span class="line">  <span class="keyword">void</span> cancel() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_overlayEntry != <span class="keyword">null</span>) &#123;</span><br><span class="line">      _overlayEntry.remove();</span><br><span class="line">      _overlayEntry = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">target组件</span></span></span><br><span class="line">  Widget target(</span><br><span class="line">    BuildContext context, &#123;</span><br><span class="line">    <span class="meta">@required</span> Widget child,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> CompositedTransformTarget(</span><br><span class="line">      link: _layerLink,</span><br><span class="line">      child: Container(</span><br><span class="line">        key: _gkey,</span><br><span class="line">        child: child,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="markdown">follower组件</span></span></span><br><span class="line">  follower(</span><br><span class="line">    BuildContext context, &#123;</span><br><span class="line">    <span class="meta">@required</span> Widget child,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// <span class="markdown">弹窗高度， 默认180</span></span></span><br><span class="line">    <span class="built_in">double</span> height,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// <span class="markdown">弹窗宽度, 默认与目标点击对象宽度一致</span></span></span><br><span class="line">    <span class="built_in">double</span> width,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// <span class="markdown">弹窗距离目标内容底部偏移offset</span></span></span><br><span class="line">    <span class="built_in">double</span> topOffset = <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// <span class="markdown">点击其他区域时回调函刷</span></span></span><br><span class="line">    <span class="built_in">Function</span> onClickOtherSpace,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// /// 弹窗弹出方向</span></span><br><span class="line">    <span class="comment">// DirectionTypeVertical directionVertical = DirectionTypeVertical.bottom,</span></span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    RenderBox renderBox = _gkey.currentContext.findRenderObject();</span><br><span class="line">    Size targetSize = renderBox.size;</span><br><span class="line">    <span class="comment">// 弹出内容是否加滚动，当两侧宽度都小的时候加</span></span><br><span class="line">    <span class="comment">// bool containerHasVerticalScroll = false;</span></span><br><span class="line">    <span class="comment">// 极端情况，后续支持，TODO</span></span><br><span class="line">    <span class="comment">// bool containerHasHorizontalScroll = false;</span></span><br><span class="line">    <span class="comment">// 全局坐标</span></span><br><span class="line">    <span class="built_in">double</span> globalPositionY = renderBox.localToGlobal(Offset.zero).dy;</span><br><span class="line">    <span class="comment">// 横坐标方向宽度</span></span><br><span class="line">    <span class="built_in">double</span> globalPositionX = renderBox.localToGlobal(Offset.zero).dx;</span><br><span class="line">    <span class="built_in">double</span> screenHeight = MediaQuery.of(context).size.height;</span><br><span class="line">    <span class="built_in">double</span> screenWidth = MediaQuery.of(context).size.width;</span><br><span class="line">    <span class="comment">// 距离窗口底部的高度</span></span><br><span class="line">    <span class="built_in">double</span> heightToBottom = screenHeight - globalPositionY;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// <span class="markdown">计算弹窗垂直弹出方向</span></span></span><br><span class="line">    DirectionTypeVertical directionVertical = DirectionTypeVertical.bottom;</span><br><span class="line">    <span class="comment">// 底部高度太小</span></span><br><span class="line">    <span class="built_in">double</span> modalHeight = height ?? defaultModalHeight;</span><br><span class="line">    <span class="keyword">if</span> (modalHeight &gt; heightToBottom) &#123;</span><br><span class="line">      directionVertical = DirectionTypeVertical.top;</span><br><span class="line">      <span class="comment">// 顶部高度也小</span></span><br><span class="line">      <span class="keyword">if</span> (modalHeight &gt; globalPositionY) &#123;</span><br><span class="line">        <span class="comment">// 选两个里面最大的滚动展示</span></span><br><span class="line">        <span class="comment">// containerHasVerticalScroll = true;</span></span><br><span class="line">        <span class="keyword">if</span> (heightToBottom &gt; globalPositionY) &#123;</span><br><span class="line">          directionVertical = DirectionTypeVertical.bottom;</span><br><span class="line">          modalHeight = heightToBottom;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          modalHeight = globalPositionY;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算水平方向弹出方向，默认左对齐</span></span><br><span class="line">    DirectionTypeHorizontal directionHorizontal = DirectionTypeHorizontal.left;</span><br><span class="line">    <span class="comment">// 距离右侧的宽度</span></span><br><span class="line">    <span class="built_in">double</span> widthToRight = screenWidth - globalPositionX;</span><br><span class="line">    <span class="comment">// 距离左侧的宽度</span></span><br><span class="line">    <span class="built_in">double</span> widthToLeft = globalPositionX + targetSize.width;</span><br><span class="line">    <span class="comment">// 弹窗的宽度</span></span><br><span class="line">    <span class="built_in">double</span> modalWidth = width ?? targetSize.width;</span><br><span class="line">    <span class="comment">// 选择框最左侧距离右边的宽度 是否 大于弹窗的宽度</span></span><br><span class="line">    <span class="keyword">if</span> (modalWidth &gt; widthToRight) &#123;</span><br><span class="line">      directionHorizontal = DirectionTypeHorizontal.right;</span><br><span class="line">      <span class="keyword">if</span> (modalWidth &gt; widthToLeft) &#123;</span><br><span class="line">        <span class="comment">// containerHasHorizontalScroll = true;</span></span><br><span class="line">        <span class="keyword">if</span> (widthToRight &gt; widthToLeft) &#123;</span><br><span class="line">          directionHorizontal = DirectionTypeHorizontal.left;</span><br><span class="line">          modalWidth = widthToRight;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          modalWidth = widthToLeft;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 右侧对齐弹出时，modal与target的宽度差距</span></span><br><span class="line">    <span class="built_in">double</span> diffRight = modalWidth + shadowWidth - targetSize.width;</span><br><span class="line">    <span class="comment">// 右侧对齐弹出时，左侧区域宽度计算</span></span><br><span class="line">    <span class="built_in">double</span> leftCloseAreaWidth =</span><br><span class="line">        directionHorizontal == DirectionTypeHorizontal.right</span><br><span class="line">            ? globalPositionX - diffRight</span><br><span class="line">            : globalPositionX;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击是关闭区域</span></span><br><span class="line">    Widget closeAreaWidget = GestureDetector(</span><br><span class="line">      behavior: HitTestBehavior.opaque,</span><br><span class="line">      onTap: () &#123;</span><br><span class="line">        cancel();</span><br><span class="line">        <span class="keyword">if</span> (onClickOtherSpace != <span class="keyword">null</span>) &#123;</span><br><span class="line">          onClickOtherSpace();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Material(color: Colors.transparent, child: SizedBox.shrink()),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    Widget showModalInner = Container(</span><br><span class="line">      margin: EdgeInsets.only(left: shadowWidth),</span><br><span class="line">      child: Container(</span><br><span class="line">        alignment: Alignment.topCenter,</span><br><span class="line">        width: modalWidth,</span><br><span class="line">        height: modalHeight,</span><br><span class="line">        child: Container(</span><br><span class="line">          child: child,</span><br><span class="line">          decoration: BoxDecoration(</span><br><span class="line">            boxShadow: [</span><br><span class="line">              BoxShadow(</span><br><span class="line">                color: Color(<span class="number">0x26585A6E</span>),</span><br><span class="line">                offset: Offset(<span class="number">0</span>, <span class="number">10</span>),</span><br><span class="line">                blurRadius: shadowWidth,</span><br><span class="line">              )</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 弹窗内容区域</span></span><br><span class="line">    Widget showModalWidget = GestureDetector(</span><br><span class="line">      behavior: HitTestBehavior.opaque,</span><br><span class="line">      onTap: () &#123;</span><br><span class="line">        cancel();</span><br><span class="line">        <span class="keyword">if</span> (onClickOtherSpace != <span class="keyword">null</span>) &#123;</span><br><span class="line">          onClickOtherSpace();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Material(</span><br><span class="line">        color: Colors.transparent,</span><br><span class="line">        child: Column(</span><br><span class="line">          crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">          children: [showModalInner],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _overlayEntry = OverlayEntry(</span><br><span class="line">        builder: (context) =&gt; Stack(</span><br><span class="line">              children: [</span><br><span class="line">                <span class="comment">// 选择框下侧区域</span></span><br><span class="line">                directionVertical == DirectionTypeVertical.bottom</span><br><span class="line">                    ? Positioned(</span><br><span class="line">                        top: <span class="number">0</span>,</span><br><span class="line">                        left: <span class="number">0</span>,</span><br><span class="line">                        right: <span class="number">0</span>,</span><br><span class="line">                        bottom: <span class="number">0</span>,</span><br><span class="line">                        child: CompositedTransformFollower(</span><br><span class="line">                          link: _layerLink,</span><br><span class="line">                          showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                          offset: Offset(</span><br><span class="line">                              directionHorizontal ==</span><br><span class="line">                                      DirectionTypeHorizontal.right</span><br><span class="line">                                  ? -diffRight</span><br><span class="line">                                  : -shadowWidth,</span><br><span class="line">                              targetSize.height + (topOffset ?? <span class="number">0</span>)),</span><br><span class="line">                          child: showModalWidget,</span><br><span class="line">                        ),</span><br><span class="line">                      )</span><br><span class="line">                    : Positioned(</span><br><span class="line">                        top: <span class="number">0</span>,</span><br><span class="line">                        left: <span class="number">0</span>,</span><br><span class="line">                        right: <span class="number">0</span>,</span><br><span class="line">                        bottom: <span class="number">0</span>,</span><br><span class="line">                        child: CompositedTransformFollower(</span><br><span class="line">                          link: _layerLink,</span><br><span class="line">                          showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                          offset: Offset(<span class="number">0</span>, targetSize.height),</span><br><span class="line">                          child: closeAreaWidget,</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">                <span class="comment">// 选择框右侧区域</span></span><br><span class="line">                Positioned(</span><br><span class="line">                  top: <span class="number">0</span>,</span><br><span class="line">                  left: <span class="number">0</span>,</span><br><span class="line">                  right: <span class="number">0</span>,</span><br><span class="line">                  height: targetSize.height,</span><br><span class="line">                  child: CompositedTransformFollower(</span><br><span class="line">                    link: _layerLink,</span><br><span class="line">                    showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                    offset: Offset(targetSize.width, <span class="number">0</span>),</span><br><span class="line">                    child: closeAreaWidget,</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                <span class="comment">// 选择框左侧区域</span></span><br><span class="line">                Positioned(</span><br><span class="line">                  top: <span class="number">0</span>,</span><br><span class="line">                  left: <span class="number">0</span>,</span><br><span class="line">                  width: leftCloseAreaWidth,</span><br><span class="line">                  height: MediaQuery.of(context).size.height,</span><br><span class="line">                  child: CompositedTransformFollower(</span><br><span class="line">                    link: _layerLink,</span><br><span class="line">                    showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                    offset: Offset(-globalPositionX, -globalPositionY),</span><br><span class="line">                    child: closeAreaWidget,</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                <span class="comment">// 选择框左上侧区域(右下弹出)</span></span><br><span class="line">                directionHorizontal == DirectionTypeHorizontal.right &amp;&amp;</span><br><span class="line">                        directionVertical == DirectionTypeVertical.bottom</span><br><span class="line">                    ? Positioned(</span><br><span class="line">                        top: <span class="number">0</span>,</span><br><span class="line">                        left: <span class="number">0</span>,</span><br><span class="line">                        width: diffRight,</span><br><span class="line">                        height: globalPositionY + targetSize.height,</span><br><span class="line">                        child: CompositedTransformFollower(</span><br><span class="line">                          link: _layerLink,</span><br><span class="line">                          showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                          offset: Offset(-diffRight, -globalPositionY),</span><br><span class="line">                          child: closeAreaWidget,</span><br><span class="line">                        ),</span><br><span class="line">                      )</span><br><span class="line">                    : SizedBox.shrink(),</span><br><span class="line">                <span class="comment">// 选择框左上侧区域(右上弹出)</span></span><br><span class="line">                directionHorizontal == DirectionTypeHorizontal.right &amp;&amp;</span><br><span class="line">                        directionVertical == DirectionTypeVertical.top</span><br><span class="line">                    ? Positioned(</span><br><span class="line">                        top: <span class="number">0</span>,</span><br><span class="line">                        left: <span class="number">0</span>,</span><br><span class="line">                        width: diffRight,</span><br><span class="line">                        height: heightToBottom,</span><br><span class="line">                        child: CompositedTransformFollower(</span><br><span class="line">                          link: _layerLink,</span><br><span class="line">                          showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                          offset: Offset(-diffRight, <span class="number">0</span>),</span><br><span class="line">                          child: closeAreaWidget,</span><br><span class="line">                        ),</span><br><span class="line">                      )</span><br><span class="line">                    : SizedBox.shrink(),</span><br><span class="line">                <span class="comment">// 选择框上侧区域</span></span><br><span class="line">                directionVertical == DirectionTypeVertical.top</span><br><span class="line">                    ? Positioned(</span><br><span class="line">                        top: <span class="number">0</span>,</span><br><span class="line">                        left: <span class="number">0</span>,</span><br><span class="line">                        right: <span class="number">0</span>,</span><br><span class="line">                        height: globalPositionY - modalHeight,</span><br><span class="line">                        child: CompositedTransformFollower(</span><br><span class="line">                          link: _layerLink,</span><br><span class="line">                          showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                          offset: Offset(<span class="number">0</span>, -globalPositionY),</span><br><span class="line">                          child: closeAreaWidget,</span><br><span class="line">                        ),</span><br><span class="line">                      )</span><br><span class="line">                    : SizedBox.shrink(),</span><br><span class="line">                directionVertical == DirectionTypeVertical.top</span><br><span class="line">                    ? Positioned(</span><br><span class="line">                        top: <span class="number">0</span>,</span><br><span class="line">                        left: <span class="number">0</span>,</span><br><span class="line">                        right: <span class="number">0</span>,</span><br><span class="line">                        height: modalHeight,</span><br><span class="line">                        child: CompositedTransformFollower(</span><br><span class="line">                          link: _layerLink,</span><br><span class="line">                          showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                          offset: Offset(</span><br><span class="line">                              directionHorizontal ==</span><br><span class="line">                                      DirectionTypeHorizontal.right</span><br><span class="line">                                  ? -diffRight</span><br><span class="line">                                  : -shadowWidth,</span><br><span class="line">                              -modalHeight),</span><br><span class="line">                          child: showModalWidget,</span><br><span class="line">                        ),</span><br><span class="line">                      )</span><br><span class="line">                    : Positioned(</span><br><span class="line">                        top: <span class="number">0</span>,</span><br><span class="line">                        left: <span class="number">0</span>,</span><br><span class="line">                        right: <span class="number">0</span>,</span><br><span class="line">                        height: globalPositionY,</span><br><span class="line">                        child: CompositedTransformFollower(</span><br><span class="line">                          link: _layerLink,</span><br><span class="line">                          showWhenUnlinked: <span class="keyword">false</span>,</span><br><span class="line">                          offset: Offset(<span class="number">0</span>, -globalPositionY),</span><br><span class="line">                          child: closeAreaWidget,</span><br><span class="line">                        ),</span><br><span class="line">                      ),</span><br><span class="line">              ],</span><br><span class="line">            ));</span><br><span class="line">    <span class="keyword">var</span> overlayState = Overlay.of(context);</span><br><span class="line">    overlayState.insert(_overlayEntry);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该组件已很好的支持实现了最开始说的PC上的组件，ToolTip组件、Selector组件、Cascade组件、以及时间选择组件。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/06/06/flutter%E5%AE%9E%E7%8E%B0%E8%B7%9F%E9%9A%8F%E6%95%88%E6%9E%9C/" data-id="clpuo0yvc0009otmu2yit9nx5" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-自定义plugin&amp;loader" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2022/03/28/%E8%87%AA%E5%AE%9A%E4%B9%89plugin&loader/">webpack自定义plugin&amp;loader</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2022/03/28/%E8%87%AA%E5%AE%9A%E4%B9%89plugin&loader/" class="article-date">
  <time datetime="2022-03-28T09:50:43.000Z" itemprop="datePublished">2022-03-28</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="插件基本结构"><a href="#插件基本结构" class="headerlink" title="插件基本结构"></a>插件基本结构</h2><p>定义：插件是由「具有 apply 方法的 prototype 对象」所实例化出来的</p>
<p>这个 apply 方法在安装插件时，会被 webpack compiler 调用一次。apply 方法可以接收一个 webpack compiler 对象的引用，从而可以在回调函数中访问到 compiler 对象。<br>s<br><strong>基本组成</strong></p>
<ul>
<li>拥有 apply 方法的对象</li>
<li>指定一个绑定到 webpack 自身的事件钩子(比如emit：生成资源到 output 目录之前， afterEmit： 生成资源到 output 目录之后)</li>
<li>处理 webpack 内部实例的特定数据(Compilation)</li>
<li>功能完成后调用 webpack 提供的回调(callback)</li>
</ul>
<p>示例：在打包内容中新增一个文件，文件内容自定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPlugin</span> </span>&#123;</span><br><span class="line">  	<span class="comment">// 通过options获取参数</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">options = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = options.name;</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="comment">// 定义apply方法</span></span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 在外层先拿到this引用，否则在匿名函数中this指向不是当前实例</span></span><br><span class="line">        <span class="keyword">const</span> self = <span class="built_in">this</span>;</span><br><span class="line">        compiler.plugin(<span class="string">&#x27;emit&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">compilation, callback</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> filelist = <span class="string">`In this build <span class="subst">$&#123;self.name&#125;</span>:\n\n`</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将这个列表作为一个新的文件资源，插入到 webpack 构建中：</span></span><br><span class="line">            compilation.assets[<span class="string">&#x27;filelist.md&#x27;</span>] = &#123;</span><br><span class="line">                <span class="attr">source</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> filelist;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">size</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> filelist.length;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (callback &amp;&amp; <span class="keyword">typeof</span> callback === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                callback();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = HelloPlugin;</span><br></pre></td></tr></table></figure>

<p>使用的时候</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &#x27;./src/index.html&#x27;,</span><br><span class="line">            title: &#x27;MyDemo&#x27;,</span><br><span class="line">        &#125;),</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &#x27;css/[name].[contenthash].css&#x27;,</span><br><span class="line">        &#125;),</span><br><span class="line">        new HelloPlugin(&#123; name: &#x27;quhandong&#x27; &#125;),</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>

<h2 id="常用插件介绍"><a href="#常用插件介绍" class="headerlink" title="常用插件介绍"></a>常用插件介绍</h2><p><strong>HtmlWebpackPlugin</strong>：生成全新的html文件，能够将所有bundle自动引入，不需要手动编写。这对于那些文件名中包含哈希值，并且哈希值会随着每次编译而改变的 webpack 包特别有用。<br><strong>MiniCssExtractPlugin</strong>：会将 CSS 提取到单独的文件中，为每个包含 CSS 的 JS 文件创建一个 CSS 文件，并且支持 CSS 和 SourceMaps 的按需加载。</p>
<h2 id="loader基本结构"><a href="#loader基本结构" class="headerlink" title="loader基本结构"></a>loader基本结构</h2><p>当一个 loader 在资源中使用，这个 loader 只能传入一个参数(source) - 这个参数是一个包含包含资源文件内容的字符串</p>
<p>同步 loader 可以简单的返回一个代表模块转化后的值。在更复杂的情况下，loader 也可以通过使用 this.callback(err, values…) 函数，返回任意数量的值。错误要么传递给这个 this.callback 函数，要么扔进同步 loader 中。</p>
<p>loader 会返回一个或者两个值。第一个值的类型是 JavaScript 代码的字符串或者 buffer。第二个参数值是 SourceMap，它是个 JavaScript 对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">&#x27;loader-utils&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertUnit</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> options = loaderUtils.getOptions(<span class="built_in">this</span>);</span><br><span class="line">   <span class="comment">// 统一处理source中正则匹配内容。。。。</span></span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义loader"><a href="#自定义loader" class="headerlink" title="自定义loader"></a>自定义loader</h2><p>定义一个处理tsx中样式单位的loader</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * tsx文件内联样式转换，px2rem &amp; px2vw</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> * UIWidth: 设计稿宽度，px2vw时必填</span></span><br><span class="line"><span class="comment"> * minPixelValue: 不进行转换的最小像素值，默认值为1px</span></span><br><span class="line"><span class="comment"> * unitPrecision: 转换值精度, 默认值4</span></span><br><span class="line"><span class="comment"> * targetUnit: 目标单位，不提供则不转换</span></span><br><span class="line"><span class="comment"> * remUnit: 1rem值大小，px2rem时必填</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> * 特殊说明： fontSize: &#x27;80px no&quot;，可在像素值后加no，表示该值不转换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">&#x27;loader-utils&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pxRegex = <span class="regexp">/(?&lt;=&#x27;|&quot;)(\d*\.*\d*)(px)(\s*no)?(?=&#x27;|&quot;)/gm</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">px2vw</span>(<span class="params">px, UIWidth</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> px / UIWidth * <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">px2rem</span>(<span class="params">px, rem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> px / rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPxReplace</span>(<span class="params">UIWidth, minPixelValue, unitPrecision, targetUnit, rem</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">m, $<span class="number">1</span>, $<span class="number">2</span>, $<span class="number">3</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($<span class="number">3</span>) &#123;</span><br><span class="line">            <span class="comment">// eslint-disable-next-line @typescript-eslint/restrict-plus-operands</span></span><br><span class="line">            <span class="keyword">return</span> $<span class="number">1</span> + $<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> pixels = <span class="built_in">parseFloat</span>($<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (pixels &lt;= minPixelValue) <span class="keyword">return</span> m;</span><br><span class="line">        <span class="keyword">if</span> (targetUnit === <span class="string">&#x27;vw&#x27;</span>) <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;px2vw(pixels, UIWidth).toFixed(unitPrecision)&#125;</span>vw`</span>;</span><br><span class="line">        <span class="keyword">if</span> (targetUnit === <span class="string">&#x27;rem&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;px2rem(pixels, rem).toFixed(unitPrecision)&#125;</span>rem`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertUnit</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> options = loaderUtils.getOptions(<span class="built_in">this</span>);</span><br><span class="line">    <span class="keyword">const</span> opts = <span class="built_in">Object</span>.assign(&#123;</span><br><span class="line">        <span class="attr">UIWidth</span>: <span class="number">750</span>,</span><br><span class="line">        <span class="attr">minPixelValue</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">unitPrecision</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">remUnit</span>: <span class="number">75</span>,</span><br><span class="line">        <span class="attr">targetUnit</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;, options);</span><br><span class="line">    <span class="keyword">const</span> pxReplace = createPxReplace(opts.UIWidth, opts.minPixelValue, opts.unitPrecision, opts.targetUnit, opts.remUnit);</span><br><span class="line">    source = source.replace(pxRegex, pxReplace);</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = convertUnit;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">   <span class="attr">rules</span>: [</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">           use: [</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">                   <span class="attr">options</span>: &#123;</span><br><span class="line">                       <span class="attr">transpileOnly</span>: <span class="literal">true</span>,</span><br><span class="line">                       <span class="attr">configFile</span>: path.resolve(__dirname, <span class="string">&#x27;tsconfig.json&#x27;</span>),</span><br><span class="line">                   &#125;,</span><br><span class="line">               &#125;,</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="attr">loader</span>: path.resolve(__dirname, <span class="string">&#x27;unit-convert-loader.js&#x27;</span>),</span><br><span class="line">                   <span class="attr">options</span>: &#123;</span><br><span class="line">                       <span class="attr">UIWidth</span>: <span class="number">750</span>,</span><br><span class="line">                       <span class="attr">unitPrecision</span>: <span class="number">4</span>,</span><br><span class="line">                       <span class="attr">targetUnit</span>: pxUnit === <span class="string">&#x27;px2vw&#x27;</span> ? <span class="string">&#x27;vw&#x27;</span> : <span class="string">&#x27;rem&#x27;</span>,</span><br><span class="line">                       <span class="attr">minPixelValue</span>: <span class="number">1</span>,</span><br><span class="line">                       <span class="attr">remUnit</span>: <span class="number">75</span>,</span><br><span class="line">                   &#125;,</span><br><span class="line"></span><br><span class="line">               &#125;,</span><br><span class="line">           ],</span><br><span class="line">       &#125;,</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p>插件：<a target="_blank" rel="noopener" href="https://www.webpackjs.com/contribute/writing-a-plugin/">https://www.webpackjs.com/contribute/writing-a-plugin/</a><br>loader: <a target="_blank" rel="noopener" href="https://www.webpackjs.com/contribute/writing-a-loader/">https://www.webpackjs.com/contribute/writing-a-loader/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2022/03/28/%E8%87%AA%E5%AE%9A%E4%B9%89plugin&loader/" data-id="clpuo0yvk000jotmud3fj8kl1" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-Dart函数" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2021/12/07/Dart%E5%87%BD%E6%95%B0/">Dart函数</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/12/07/Dart%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2021-12-07T09:53:43.000Z" itemprop="datePublished">2021-12-07</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="普通函数"><a href="#普通函数" class="headerlink" title="普通函数"></a>普通函数</h2><p>如果一个函数没有显示声明返回值，Dart 会自动推导它的返回值类型</p>
<p>如果一个函数没有显示的 return，那么它默认会返回 null</p>
<p>如果一个函数只有一句表达式，可以使用简写：</p>
<h3 id="函数简写"><a href="#函数简写" class="headerlink" title="函数简写"></a>函数简写</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> isNoble(<span class="built_in">int</span> atomicNumber) =&gt; atomicNumber != <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h3 id="可选位置参数pa-positional-arguments"><a href="#可选位置参数pa-positional-arguments" class="headerlink" title="可选位置参数pa (positional arguments)"></a>可选位置参数pa (positional arguments)</h3><p>语法形式：放在数组中的</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> say(<span class="built_in">String</span> from, <span class="built_in">String</span> msg, [<span class="built_in">String</span> device = <span class="string">&#x27;carrier pigeon&#x27;</span>, <span class="built_in">String</span> mood = <span class="string">&#x27;&#x27;</span>]) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用时，严格按照位置传参数，写在数组中的参数是可选的，以下情况都是对的</span></span><br><span class="line">say(<span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;msg&#x27;</span>, <span class="string">&#x27;device&#x27;</span>, <span class="string">&#x27;mood&#x27;</span>);</span><br><span class="line">say(<span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;msg&#x27;</span>, <span class="string">&#x27;device&#x27;</span>);</span><br><span class="line">say(<span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;msg&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="可选命名参数na-named-arguments"><a href="#可选命名参数na-named-arguments" class="headerlink" title="可选命名参数na (named arguments)"></a>可选命名参数na (named arguments)</h3><p>语法形式：放在对象中的</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> enableFlags(&#123;<span class="built_in">bool</span> bold = <span class="keyword">false</span>, <span class="built_in">bool</span> hidden = <span class="keyword">false</span>, <span class="meta">@required</span> <span class="built_in">String</span> content&#125;) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用时，使用具体名称，其中@required是必填参数</span></span><br><span class="line">enableFlags(bold: <span class="keyword">true</span>, hidden: <span class="keyword">false</span>, content: <span class="string">&#x27;haha&#x27;</span>);</span><br><span class="line">enableFlags(bold: <span class="keyword">true</span>, content: <span class="string">&#x27;haha&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><h3 id="默认构造函数"><a href="#默认构造函数" class="headerlink" title="默认构造函数"></a>默认构造函数</h3><p>如果你定义了一个类，而没有定义构造函数，那么它将有一个默认的构造函数，这个构造函数 没有参数</p>
<p>如果这个类有父类，那么默认构造函数，还会调用父类的无参数构造函数。</p>
<h3 id="普通构造函数"><a href="#普通构造函数" class="headerlink" title="普通构造函数"></a>普通构造函数</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> x = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> y = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// 变量多的时候麻烦</span></span><br><span class="line">  Point(<span class="built_in">double</span> x, <span class="built_in">double</span> y) &#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 语法糖</span></span><br><span class="line">   Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="命名构造函数"><a href="#命名构造函数" class="headerlink" title="命名构造函数"></a>命名构造函数</h3><p>命名构造函数不可继承，如果子类想要有和父类一样的命名构造函数，那就写个同名的，没有关系</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> x;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> y;</span><br><span class="line">  Point.origin() &#123;</span><br><span class="line">    x = <span class="number">0</span>;</span><br><span class="line">    y = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="构造函数调用父类构造函数的顺序"><a href="#构造函数调用父类构造函数的顺序" class="headerlink" title="构造函数调用父类构造函数的顺序"></a>构造函数调用父类构造函数的顺序</h3><p>1、 子类构造函数无显示调用时,默认调用父类无参构造函数</p>
<p>2、 子类显示调用父类构造函数,应该在初始化列表中完成</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  Person p = Student.fromJson(); <span class="comment">// 用Person声明只能访问Person类中的成员变量</span></span><br><span class="line">  <span class="built_in">print</span>(p.runtimeType); <span class="comment">// Student</span></span><br><span class="line">  <span class="built_in">print</span>(p.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  Person.fromJson()&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;person&#x27;</span>);</span><br><span class="line">    name = <span class="string">&#x27;hehe&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  Student.fromJson(): <span class="keyword">super</span>.fromJson() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;student&#x27;</span>);</span><br><span class="line">    name = <span class="string">&#x27;haha&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出内容</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">person</span></span><br><span class="line"><span class="comment">student</span></span><br><span class="line"><span class="comment">Student</span></span><br><span class="line"><span class="comment">haha</span></span><br><span class="line"><span class="comment">/</span></span><br></pre></td></tr></table></figure>

<h3 id="初始化列表"><a href="#初始化列表" class="headerlink" title="初始化列表"></a>初始化列表</h3><p>初始化列表就是构造函数名的冒号后面，大括号前面的部分</p>
<p>初始化列表的执行顺序，在整个构造函数的最前面，它除了可以调用父类的构造函数，还可以在构造函数方法体之前，做一些初始化一些final成员变量的操作。</p>
<p>(初始化成员变量顺序: 初始化列表、父类构造函数、子类构造函数)</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  Student p = Student.fromJson(<span class="string">&#x27;girl&#x27;</span>, <span class="number">16</span>);</span><br><span class="line">  <span class="built_in">print</span>(p.runtimeType);</span><br><span class="line">  <span class="built_in">print</span>(p.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> name = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  Person.fromJson()&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;person&#x27;</span>);</span><br><span class="line">    name = <span class="string">&#x27;hehe&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在构造函数方法体中，不能给final修饰的成员变量赋值，因为在执行方法体的时候，final修饰的成员变量已经不能变了。这个地方很多人犯错。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> sex;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> age;</span><br><span class="line">  Student.fromJson(<span class="built_in">String</span> sex, <span class="built_in">int</span> age): sex = sex, age = age, <span class="keyword">super</span>.fromJson() &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;student&#x27;</span>);</span><br><span class="line">    name = <span class="string">&#x27;haha&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 另外初始化final成员变量的写法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> sex;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> age;</span><br><span class="line">  Student(<span class="keyword">this</span>.sex, <span class="keyword">this</span>.age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面这种写法,无法避免sex等成员变量值为null</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> sex;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> age;</span><br><span class="line">  Student(&#123;<span class="keyword">this</span>.sex, <span class="keyword">this</span>.age&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以在声明的时候写兜底值，如果没有兜底，使用的时候需要做空判断</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> sex = <span class="string">&#x27;girl&#x27;</span>;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> age = <span class="number">15</span>;</span><br><span class="line">  Student(&#123;<span class="keyword">this</span>.sex, <span class="keyword">this</span>.age&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 业务代码中常见下面的写法,记得判空</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DynamicHeaderBg</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  DynamicHeaderBg(&#123;</span><br><span class="line">    <span class="meta">@required</span> context,</span><br><span class="line">    <span class="keyword">this</span>.contentList, <span class="comment">// 内容区域</span></span><br><span class="line">    <span class="keyword">this</span>.title, <span class="comment">// 标题文案</span></span><br><span class="line">    <span class="keyword">this</span>.actionList, <span class="comment">// 右侧跳转</span></span><br><span class="line">    <span class="keyword">this</span>.pageBgColor, <span class="comment">// 背景颜色</span></span><br><span class="line">    <span class="keyword">this</span>.bottomWidget, <span class="comment">//底部固定</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">final</span> Widget bottomWidget;</span><br><span class="line">  <span class="keyword">final</span> Widget contentList;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;Widget&gt; actionList;</span><br><span class="line">  <span class="keyword">final</span> Color pageBgColor;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _DynamicHeaderBgState createState() =&gt; _DynamicHeaderBgState();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="构造函数传递"><a href="#构造函数传递" class="headerlink" title="构造函数传递"></a>构造函数传递</h3><p>构造函数中相同逻辑,分别在各个构造函数中实现有些冗余,所以构造函数可以传递</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> x, y;</span><br><span class="line">  Point(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line">  Point.alongXAxis(<span class="built_in">double</span> x) : <span class="keyword">this</span>(x, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常量构造函数"><a href="#常量构造函数" class="headerlink" title="常量构造函数"></a>常量构造函数</h3><p>如果你的类，创建的对象永远不会改变，你可以通过常量构造函数在编译期就创建这个常量实例</p>
<p>实际应用中, 如果我们的map值是某种json格式的对象时, 不同的key对应不同的的常量对象, 就可以这么写</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImmutablePoint</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> ImmutablePoint origin = ImmutablePoint(<span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 可以写在外面</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> x, y;</span><br><span class="line">  <span class="keyword">const</span> ImmutablePoint(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, ImmutablePoint&gt; enumXX = &#123;</span><br><span class="line">    <span class="string">&#x27;big&#x27;</span>:  <span class="keyword">const</span> ImmutablePoint(<span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="string">&#x27;small&#x27;</span>: <span class="keyword">const</span> ImmutablePoint(<span class="number">2</span>, <span class="number">0</span>),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">print</span>(enumXX[<span class="string">&#x27;big&#x27;</span>]?.x);</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">EnumXX</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> ImmutablePoint big = ImmutablePoint(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> ImmutablePoint small = ImmutablePoint(<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> 	<span class="built_in">print</span>(EnumXX.big?.x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="工厂构造函数"><a href="#工厂构造函数" class="headerlink" title="工厂构造函数"></a>工厂构造函数</h3><p>有时候可能有一种需求，并不需要每次都创建新的类实例，而是每一种情况，只需要一个实例</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Logger&gt; _cache =</span><br><span class="line">      &lt;<span class="built_in">String</span>, Logger&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> Logger(<span class="built_in">String</span> name) &#123; <span class="comment">// 工厂构造函数里面无法访问this</span></span><br><span class="line">    <span class="keyword">if</span> (_cache.containsKey(name)) &#123;</span><br><span class="line">      <span class="keyword">return</span> _cache[name];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> logger = Logger._internal(name);</span><br><span class="line">      _cache[name] = logger;</span><br><span class="line">      <span class="keyword">return</span> logger;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Logger._internal(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">var</span> logger = Logger(<span class="string">&#x27;UI&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的例子:</p>
<p>类中有一个静态缓存_cache保存着一些Logger类实例，创建实例时，给工厂构造函数传递的name，如果在缓存中已经存在，就用缓存中现成的实例，如果没有，就新建一个实例，并且也放到缓存中。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/12/07/Dart%E5%87%BD%E6%95%B0/" data-id="clpuo0yv10000otmud51h0lo6" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-浏览器缓存" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2021/11/26/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/">Http缓存</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/11/26/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/" class="article-date">
  <time datetime="2021-11-26T09:50:43.000Z" itemprop="datePublished">2021-11-26</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="什么是-HTTP-缓存？"><a href="#什么是-HTTP-缓存？" class="headerlink" title="什么是 HTTP 缓存？"></a>什么是 HTTP 缓存？</h2><p>浏览器缓存通常情况下指的就是 HTTP 缓存，目前浏览器都各自基于 RFC 标准实现了 HTTP 缓存能力，通过 HTTP Headers 执行对应的缓存策略。</p>
<p>对于一个缓存来说，可以分为 缓存存储 和 缓存应用 两个部分，缓存应用下根据规则又分为不同的缓存策略。</p>
<h3 id="1-缓存存储对象"><a href="#1-缓存存储对象" class="headerlink" title="1. 缓存存储对象"></a>1. 缓存存储对象</h3><p>通常 HTTP 缓存只适用于 idempotent request（可以理解为查询请求，也就是不更新服务端数据的请求），缓存的对象通常是 html文件、css、js、图片等通过 GET 请求返回的资源文件；</p>
<p>浏览器第一次发起对 /index.html 的请求：</p>
<ul>
<li>由于本地缓存为空，浏览器直接向服务器发起请求；</li>
<li>服务器返回响应，并设置了一些响应头来控制资源在浏览器的缓存行为；</li>
<li>浏览器收到请求，将响应头与资源一起缓存，并将资源用于页面展示;</li>
</ul>
<p>通常在本地无禁止缓存的配置情况下，缓存是浏览器的默认行为。所以 HTTP 缓存体系更多的内容是对缓存校验，防止缓存并使用已经过期的资源。</p>
<h3 id="2-强缓存"><a href="#2-强缓存" class="headerlink" title="2. 强缓存"></a>2. 强缓存</h3><p>当浏览器发起请求时，首先从本地缓存中检索是否存在当前请求的副本，如果找到本地缓存并且符合使用条件，即可直接使用该副本，这就是强缓存。</p>
<p>我们依旧使用画出浏览器和服务端通信，模拟强缓存的过程：</p>
<ol>
<li>50 秒后浏览器再次发起对 /index.html 的请求，检索到缓存中的 GET /index.html</li>
<li>根据缓存中的 Cache-Control: max-age=200 ，表示资源在发起请求后的 200 秒内可以被直接使用，于是直接从缓存读取响应，不向浏览器发出请求。</li>
</ol>
<h4 id="Cache-control"><a href="#Cache-control" class="headerlink" title="Cache-control"></a>Cache-control</h4><p>Cache-Control 是 HTTP1.1 缓存策略中最重要的字段，可以由多个字段组合而成，下面是常用的值：</p>
<h5 id="1-no-cache-与-no-store"><a href="#1-no-cache-与-no-store" class="headerlink" title="(1)no-cache 与 no-store"></a><strong>(1)no-cache 与 no-store</strong></h5><p>no-cache 表示在使用本地资源缓存之前，必须先请求服务器判断资源是否已经过期，才能使用该缓存；</p>
<p>no-store 则是直接禁止浏览器以及所有中间缓存存储任何版本的返回响应；</p>
<h5 id="2-max-age"><a href="#2-max-age" class="headerlink" title="(2)max-age"></a><strong>(2)max-age</strong></h5><p>max-age 指令表示从请求发起，到其所设定的时间之内（单位：秒），可直接使用本地缓存。例如，max-age=60 表示可在接下来的 60 秒内缓存可以重用；</p>
<h5 id="3-must-revalidate"><a href="#3-must-revalidate" class="headerlink" title="(3)must-revalidate"></a><strong>(3)must-revalidate</strong></h5><p>must-revalidate 和 no-cache 的含义相似，不同之处在于 must-revalidate 会在当前资源过期后验证缓存，而 no-cache 无视缓存设定时间立即发出请求验证；</p>
<p>所以 max-age=0, must-revalidate 与 no-cache 表示一个意思；</p>
<h5 id="4-public-与-private"><a href="#4-public-与-private" class="headerlink" title="(4)public 与 private"></a><strong>(4)public 与 private</strong></h5><p>public 客户端和代理服务器都可以缓存响应所有内容；</p>
<p>private 表示这些响应只为单个用户缓存，不允许任何中间代理对其进行缓存；</p>
<h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h4><p>Expires是 HTTP/1.0 控制网页缓存的字段，是一个绝对时间点，例如：</p>
<p><code>expires: Thu, 19 Nov 1981 08:52:00 GMT</code></p>
<p>表示相比与客户端本地时间，缓存在该绝对时间点之前有效，再次发起该请求时，如果客户端的时间小于Expires的值时，直接使用缓存。</p>
<p>注意：Expires 控制缓存的原理是使用客户端的时间与服务端返回的时间做对比，如果客户端与服务端的时间因为某些原因（例如时区不同；客户端和服务端有一方的时间不准确）发生误差，那么强制缓存则会直接失效，这样的话强制缓存的存在则毫无意义。</p>
<p>所以到了HTTP/1.1，Expire已经被Cache-Control替代，Cache-Control 中指定的缓存过期策略优先级高于 Expires，当它们同时存在的时候，后者会被覆盖掉。</p>
<h3 id="3-协商缓存"><a href="#3-协商缓存" class="headerlink" title="3. 协商缓存"></a>3. 协商缓存</h3><p>如果当前请求未命中强缓存，并不直接代表的资源已不可用，而需要询问服务器该资源是否可以继续使用：</p>
<ul>
<li><ol>
<li>如果服务端资源未发生过变化，没必要再下载一遍资源；</li>
</ol>
</li>
<li><ol>
<li>如果资源发生了变化，则返回最新的资源并替换旧资源；</li>
</ol>
</li>
</ul>
<p>这就是协商缓存的过程。</p>
<p>我们还是按照浏览器页面、浏览器缓存、服务器来模拟一下这个过程：</p>
<ol>
<li>距离第一次请求 220 秒后，浏览器再次发起对 /index.html 的请求，检索到本地有以 GET /index.html 为 key 值的资源，根据 max-age=200 本地缓存已过期；</li>
<li>浏览器发起验证本地缓存的请求，将缓存标识携带在请求头 If-None-Match 上，缓存标识对应第一次请求响应头里的 Etag;</li>
<li>服务器依据请求中的 If-None-Match 值校验，向客户端返回 304 Not Modified 状态码；</li>
<li>浏览器被告知资源未发生变化，可以再延用 200 秒，于是直接使用缓存中的 /index.html；</li>
</ol>
<p>所以，协商缓存的关键在于携带资源标识请求服务器，来判断资源是否发生变更。</p>
<p>这一过程是由 ETag/If-None-Match 和 Last-Modified/If-Modified-Since 两对Header来管理的。</p>
<h4 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag/If-None-Match"></a><strong>Etag/If-None-Match</strong></h4><ul>
<li>Etag 是由服务器端根据资源生成的一段 hash 字符串，第一次请求时响应头携带 ETag: abc；</li>
<li>之后的请求中，浏览器自动检测缓存的响应头是否包含 ETag，并追加到请求头 If-None-Match: abc；</li>
<li>服务端通过验证 ETag 是否一致来判断客户端缓存数据是否仍有效，进而决定是否要重发数据。</li>
</ul>
<h4 id="Last-modified-If-Modified-Since"><a href="#Last-modified-If-Modified-Since" class="headerlink" title="Last-modified/If-Modified-Since"></a><strong>Last-modified/If-Modified-Since</strong></h4><ul>
<li>Last-modified 是 HTTP 1.0 中的缓存协议，表示服务器端资源的最后修改时间，与 ETag 一致，跟在资源响应的头部，在第一次请求后随资源一起缓存；</li>
<li>之后的请求浏览器追加请求头 If-Modified-Since ，即为之前缓存下的 Last-modified 时间。服务器端收到带 If-Modified-Since 的请求后会去和资源的最后修改时间对比。</li>
<li>若资源的最后修改时间大于 If-Modified-Since，说明资源被改动过，返回状态码 200 同时返回整个资源，反之返回 304，告知浏览器继续可继续使用缓存；</li>
</ul>
<p>使用 Last-modified 也具有一些场景上的缺陷：</p>
<ul>
<li>某些服务器不能精确的得到文件的最后修改时间；</li>
<li>Last-modified 只能精确到秒；</li>
<li>如果在本地打开缓存文件，就会造成 Last-Modified 被修改，导致协商缓存判断出错；</li>
</ul>
<p>而 Etag 要求资源字节级别的一致，属于强验证，相比于 Last-modified 优先级更高。</p>
<p><strong>注意</strong>：实际使用 ETag/Last-modified 要注意保持一致性，做负载均衡和反向代理的话可能会出现不一致的情况。计算 ETag 也是需要占用资源的，如果修改不是过于频繁，看自己的需求用 Cache-Control 是否可以满足。</p>
<h3 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h3><p>HTTP 缓存原理主要是由强缓存和协商缓存组成的体系，总计起来就是以下几点：</p>
<ol>
<li>当浏览器请求一个资源时，先通过 Cache-Control 和 Expires 判断强缓存是否生效，生效则直接使用缓存；</li>
<li>若强缓存不生效，则发起请求与服务器进行协商缓存，协商缓存生效返回 304，不生效则返回 200 + 最新资源；</li>
<li>协商缓存 ETag/If-None-Match 和 Last-Modified/If-Modified-Since 两对 Header 来实现；</li>
<li>HTTP 1.1 协议定义的头字段优先级高于 HTTP 1.0，通常两种字段都会设定来保证向后兼容；</li>
</ol>
<p>HTTP 缓存原理并不复杂，也不存在标准的使用方式，不同场景需要按照实际情况配置不同的缓存策略，让缓存发挥到最大的作用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/11/26/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/" data-id="clpuo0yvj000iotmu9pusawmz" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-正则表达式" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2021/11/06/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/11/06/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="article-date">
  <time datetime="2021-11-06T09:50:43.000Z" itemprop="datePublished">2021-11-06</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="1、正则表达式能做什么"><a href="#1、正则表达式能做什么" class="headerlink" title="1、正则表达式能做什么"></a>1、正则表达式能做什么</h2><p>正则表达式使用简单的字符串来描述、匹配一系列匹配某个句法规则的字符串，虽然表达式繁琐，但很强大，掌握正则匹配，不仅可以提升开发效率，用好的话，还会多一些成就感。</p>
<p>举个🌰：实现千分位分割函数</p>
<p>简单方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toThousands</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>, counter = <span class="number">0</span>;</span><br><span class="line">    num = (num || <span class="number">0</span>).toString();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = num.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        counter++;</span><br><span class="line">        result = num.charAt(i) + result;</span><br><span class="line">        <span class="keyword">if</span> (!(counter % <span class="number">3</span>) &amp;&amp; i != <span class="number">0</span>) &#123; result = <span class="string">&#x27;,&#x27;</span> + result; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<p>正则表达式方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toThousands</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (num || <span class="number">0</span>).toString().replace(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>, <span class="string">&#x27;$1,&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">\d&#123;<span class="number">3</span>&#125; <span class="comment">// 3个数字</span></span><br><span class="line">(\d&#123;<span class="number">3</span>&#125;)+$  <span class="comment">// 一组或多组3个数字,一直到字符串结尾</span></span><br><span class="line">(\d)(?=(\d&#123;<span class="number">3</span>&#125;)+$) <span class="comment">// ?=是正向肯定预查, 前面的数字是第一个捕获组, 拿到$1后添加,</span></span><br><span class="line">/(\d)(?=(\d&#123;<span class="number">3</span>&#125;)+$)/g <span class="comment">// 全局匹配所有满足条件的位置进行替换</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面我们简单概括下正则实际应用场景</p>
<p>1、<strong>匹配验证</strong>： input框的校验，比如手机号、qq号、密码等的校验</p>
<p>JS中RegExp的方法有:</p>
<p><code>reg.test(string) </code>：如果找到匹配项，则返回true，否则返回false</p>
<p><code>reg.exec(string)</code>：返回一个数组，第一项存储匹配到的字符串，如果是分组捕获，第二项开始分别是各个捕获组的值。这个数组还拥有两个属性分别是index和input，index代表匹配的开始位置，input表示输入的字符串参数</p>
<p>使用⚠️：当执行全局匹配时，上述两个方法的匹配下标是会被更改的，因为匹配下标是正则对象上的属性，他会跟正则对象一直存在，这个时候就要注意，先后校验多个字符串的开始位置，可能不同</p>
<p>2、<strong>查找替换</strong>：找到给定字符串中满足正则表达式的内容，还可对查找内容进行替换</p>
<p>JS中字符串方法有：</p>
<p><code>search(searchValue)</code> ：返回正则表达式在字符串中首次匹配项的索引，没找到返回-1，searchValue可以是字符串或正则表达式</p>
<p><code>match(regExp)</code> : regExp是正则表达式，当regExp是字符串时，会自动转成非全局匹配的正则表达式</p>
<ul>
<li>没有匹配返回null;</li>
<li>全局匹配，返回一个数组存储着正则匹配的多个结果；</li>
<li>非全局，那么返回第一次匹配的结果和它相关的捕获组。</li>
</ul>
<p><code>replace(regexp|substr, newSubStr|function)</code> ：</p>
<ul>
<li>regexp: 一个正则对象或其字面量</li>
<li>substr: 一个字符串，仅第一个匹配项会被替换，相当于非全局匹配</li>
<li>newSubStr: 用于替换掉在原字符串中的匹配部分的字符串，该字符串中可以内插一些特殊的变量名:</li>
</ul>
<table>
<thead>
<tr>
<th align="left">变量名</th>
<th align="left">代表的值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$$</td>
<td align="left">插入一个 “$”</td>
</tr>
<tr>
<td align="left">$&amp;</td>
<td align="left">插入匹配的子串</td>
</tr>
<tr>
<td align="left">$`</td>
<td align="left">插入当前匹配的子串左边的内容</td>
</tr>
<tr>
<td align="left">$’</td>
<td align="left">插入当前匹配的子串右边的内容</td>
</tr>
<tr>
<td align="left">$n</td>
<td align="left">假如第一个参数是 RegExp对象，并且 n 是个小于100的非负整数，那么插入第 n 个括号匹配的字符串。提示：索引是从1开始</td>
</tr>
</tbody></table>
<ul>
<li>function：指定一个函数作为第二个参数。在这种情况下，当匹配执行后，该函数就会执行。 函数的返回值作为替换字符串, (注意：上面提到的特殊替换参数在这里不能被使用。) 另外要注意的是，如果第一个参数是正则表达式，并且其为全局匹配模式，那么这个方法将被多次调用，每次匹配都会被调用。下面是函数的参数内容：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">变量名</th>
<th align="left">代表的值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">match</td>
<td align="left">匹配的子串。（对应于上述的$&amp;)</td>
</tr>
<tr>
<td align="left">p1,p2, …</td>
<td align="left">假如replace()方法的第一个参数是一个RegExp 对象，则代表第n个括号匹配的字符串。（对应于上述的$1，$2等。）例如，如果是用 /(\a+)(\b+)/ 这个来匹配，p1 就是匹配的 \a+，p2 就是匹配的 \b+</td>
</tr>
<tr>
<td align="left">offset</td>
<td align="left">匹配到的子字符串在原字符串中的偏移量。（比如，如果原字符串是 ‘abcd’，匹配到的子字符串是 ‘bc’，那么这个参数将会是 1）</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">被匹配的原字符串</td>
</tr>
<tr>
<td align="left">NamedCaptureGroup</td>
<td align="left">命名捕获组匹配的对象</td>
</tr>
</tbody></table>
<p>3、<strong>字符串分割</strong>：将符合正则表达式规则的子串作为分隔符分割字符串，JS中的方法如下：</p>
<p><code>split(separator, limit)</code>返回 separator分割的子串组成的数组，separator可以是字符串或正则表达式， limit会限制返回的数组长度。</p>
<ul>
<li>如果分割符是空字符串，则返回字符串中所有字符组成的数组；</li>
<li>如果分割符省略不写，则返回数组包含一个由整个字符串组成的元素；</li>
<li>如果字符串仅由一个分隔符实例组成，则返回的数组由两个空字符串组成，也就是说匹配到开头和结尾，开头的左侧和结尾的右侧都以空字符串的形式放到数组中。</li>
<li>当字符串为空时，split()返回一个包含一个空字符串的数组，而不是一个空数组，如果字符串和分隔符都是空字符串，则返回一个空数组。</li>
</ul>
<h2 id="正则表达式中的字符"><a href="#正则表达式中的字符" class="headerlink" title="正则表达式中的字符"></a>正则表达式中的字符</h2><h3 id="2-1-字符分类"><a href="#2-1-字符分类" class="headerlink" title="2.1 字符分类"></a>2.1 字符分类</h3><p>包括普通字符和元字符</p>
<p>普通字符：匹配其本身的字符，大多数字符都是，如数字（0-9），字母（a-z, A-Z）等。</p>
<p>元字符：正则表达式除了进行字符自身的匹配外，还可以基于指定的规则进行模糊匹配，这就意味着它需要一些特殊字符来表示这些模糊的匹配规则。<a target="_blank" rel="noopener" href="https://www.runoob.com/regexp/regexp-metachar.html">元字符表</a></p>
<p>⚠️ 如果想匹配元字符本身，需要进行转义。我们需要重点关注的就是元字符，这也是掌握正则的核心内容。</p>
<h3 id="2-2-重点元字符详解"><a href="#2-2-重点元字符详解" class="headerlink" title="2.2 重点元字符详解"></a>2.2 重点元字符详解</h3><table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">\</td>
<td align="left">转义字符， 例如，’n’ 匹配字符 “n”。’\n’ 匹配一个换行符。序列 ‘\‘ 匹配 “&quot; 而 “(“ 则匹配 “(“</td>
</tr>
<tr>
<td align="left">^</td>
<td align="left">匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 ‘\n’ 或 ‘\r’ 之后的位置</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 ‘\n’ 或 ‘\r’ 之前的位置</td>
</tr>
<tr>
<td align="left">?</td>
<td align="left">当该字符紧跟在任何一个其他限制符 (*, +, ?, {n}, {n,}, {n,m}) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 “oooo”，’o+?’ 将匹配单个 “o”，而 ‘o+’ 将匹配所有 ‘o’</td>
</tr>
<tr>
<td align="left">.</td>
<td align="left">匹配除换行符（\n、\r）之外的任何单个字符。要匹配包括 ‘\n’ 在内的任何字符，请使用”(.|\n)”的模式</td>
</tr>
</tbody></table>
<p><strong>a、字符集合</strong></p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">x|y</td>
<td align="left">匹配 x 或 y。例如，’z|food’ 能匹配 “z” 或 “food”。’(z|f)ood’ 则匹配 “zood” 或 “food”</td>
</tr>
<tr>
<td align="left">[xyz]</td>
<td align="left">字符集合。匹配所包含的任意一个字符。例如， ‘[abc]’ 可以匹配 “plain” 中的 ‘a’</td>
</tr>
<tr>
<td align="left">[^xyz]</td>
<td align="left">匹配未包含的任意字符</td>
</tr>
<tr>
<td align="left">[a-z]</td>
<td align="left">字符范围。匹配指定范围内的任意字符</td>
</tr>
<tr>
<td align="left">[^a-z]</td>
<td align="left">匹配任何不在指定范围内的任意字符</td>
</tr>
</tbody></table>
<p>⚠️ 注：所有的特殊字符在[]内都将失去其原有的特殊含义:</p>
<p>有些特殊字符在[]中被赋予新的特殊含义，比如‘^’,出现开始表示集合内容取反，而在其它位置就变成普通字符，表示其本身含义；’-‘在 []内部表示字符或数字区间，而放在第一个字符位置表示本身，’]’放在第一个字符位置也表示本身；</p>
<p>其余特殊字符则直接变为普通字符，如 ‘.’, ‘*’, ‘+’, ‘?’, ‘$’等。不需要转义</p>
<p><strong>b、预定义字符集</strong></p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">\b</td>
<td align="left">匹配一个单词的边界，指的是单词和空格间的位置，例如， ‘er\b’ 可以匹配”never” 中的 ‘er’，但不能匹配 “verb” 中的 ‘er’。\B相反</td>
</tr>
<tr>
<td align="left">\d</td>
<td align="left">匹配一个数字字符，等价于[0-9]，\D相反</td>
</tr>
<tr>
<td align="left">\s</td>
<td align="left">匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \f\n\r\t\v]，\S相反</td>
</tr>
<tr>
<td align="left">\w</td>
<td align="left">匹配字母、数字、下划线。等价于’[A-Za-z0-9_]’，\W相反</td>
</tr>
</tbody></table>
<p><strong>c、匹配量词</strong></p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">*</td>
<td align="left">匹配零次或多次。例如，zo* 能匹配 “z” 以及 “zoo”。* 等价于{0,}</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left">匹配一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}</td>
</tr>
<tr>
<td align="left">？</td>
<td align="left">匹配零次或一次。例如，”do(es)?” 可以匹配 “do” 或 “does” 。? 等价于 {0,1}</td>
</tr>
<tr>
<td align="left">{n}</td>
<td align="left">匹配确定的n次</td>
</tr>
<tr>
<td align="left">{n,m}</td>
<td align="left">最少匹配n次，最多匹配m次</td>
</tr>
<tr>
<td align="left">{m,}</td>
<td align="left">最少匹配m次</td>
</tr>
</tbody></table>
<p><strong>d、匹配捕获模式</strong></p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">(pattern)</td>
<td align="left">匹配 pattern 并获取这一匹配，在JScript 中则使用 $1…$9 等属性值获取捕获内容,每个圆括号内捕获内容为一组，也就是捕获组</td>
</tr>
<tr>
<td align="left">(?:pattern)</td>
<td align="left">匹配 pattern 但不获取匹配结果，这是一个非获取匹配</td>
</tr>
<tr>
<td align="left">a(?=b)</td>
<td align="left">正向肯定预查，匹配后面有b的a，非获取匹配</td>
</tr>
<tr>
<td align="left">a(?!b)</td>
<td align="left">正向否定预查(negative assert)，匹配后面没有b的a，非获取匹配</td>
</tr>
<tr>
<td align="left">(?&lt;=a)b</td>
<td align="left">反向(look behind)肯定预查，匹配前面有a的b，非获取匹配</td>
</tr>
<tr>
<td align="left">(?&lt;!a)b</td>
<td align="left">反向否定预查，匹配前面没有a的b，非获取匹配</td>
</tr>
</tbody></table>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> r2 = <span class="regexp">/do(?:es)??/</span>;</span><br><span class="line"><span class="built_in">console</span>.log(r2.exec(<span class="string">&#x27;does&#x27;</span>));</span><br><span class="line"><span class="comment">// 请问输出？？</span></span><br></pre></td></tr></table></figure>

<h2 id="3、正则表达式匹配规则"><a href="#3、正则表达式匹配规则" class="headerlink" title="3、正则表达式匹配规则"></a>3、正则表达式匹配规则</h2><h3 id="3-1-运算符优先级"><a href="#3-1-运算符优先级" class="headerlink" title="3.1 运算符优先级"></a>3.1 运算符优先级</h3><p>正则表达式从左到右进行计算，并遵循优先级顺序（下表从上到下，优先级降低），这与算术表达式非常类似。</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">\</td>
<td align="left">转义符</td>
</tr>
<tr>
<td align="left">(), (?:), (?=), []</td>
<td align="left">圆括号，方括号</td>
</tr>
<tr>
<td align="left">*, +, ?, {n}, {n,}, {n,m}</td>
<td align="left">量词限定符</td>
</tr>
<tr>
<td align="left">^, $, \任何元字符、任何字符</td>
<td align="left">定位点和序列（即：位置和顺序）</td>
</tr>
<tr>
<td align="left">|</td>
<td align="left">替换， “或”操作， 字符的优先级都比它高, 比如： 使得”m|food”匹配”m”或”food”。若要匹配”mood”或”food”，请使用括号创建子表达式，从而产生”(m|f)ood”</td>
</tr>
</tbody></table>
<h3 id="3-2-匹配过程"><a href="#3-2-匹配过程" class="headerlink" title="3.2 匹配过程"></a>3.2 匹配过程</h3><p>针对含有至少意义的量词：?, +, *, {m,n}, {m,}，在与字符串匹配过程中，他们总是尽可能多的匹配量词所修饰的内容，这称之为贪婪模式（或非惰性匹配）</p>
<p>如果在他们后面加上?，如??, +?, *?, {m,n}?, {m,}?，就变成了非贪婪模式（或惰性匹配），在整个表达式匹配成功的前提下，尽可能少的去匹配量词所修饰的字符</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> testR = <span class="regexp">/&lt;div&gt;.*&lt;\/div&gt;/</span>;</span><br><span class="line"><span class="keyword">const</span> testR1 = <span class="regexp">/&lt;div&gt;.*?&lt;\/div&gt;/</span>;</span><br><span class="line"><span class="keyword">const</span> stringMi = <span class="string">&#x27;aa&lt;div&gt;test1&lt;/div&gt;bb&lt;div&gt;test2&lt;/div&gt;cc&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(testR.exec(stringMi));</span><br><span class="line"><span class="built_in">console</span>.log(testR1.exec(stringMi));</span><br></pre></td></tr></table></figure>

<p>推荐一个好用的线上验证正则的网址<a target="_blank" rel="noopener" href="https://regex101.com/">正则校验</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/11/06/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" data-id="clpuo0yvi000hotmud7etdwxe" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-初识webpack" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2021/10/26/%E5%88%9D%E8%AF%86webpack/">了解webpack</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/10/26/%E5%88%9D%E8%AF%86webpack/" class="article-date">
  <time datetime="2021-10-26T09:50:43.000Z" itemprop="datePublished">2021-10-26</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="核心功能概述"><a href="#核心功能概述" class="headerlink" title="核心功能概述"></a>核心功能概述</h2><ol>
<li>资源管理：webpack 最出色的功能之一就是，除了引入 JavaScript，还可以通过 loader 或内置的 Asset Modules 引入任何其他类型的文件</li>
<li>提供强大的source map能力，<code>devtool: &#39;inline-source-map&#39;</code></li>
<li>代码变化后自动编译的能力<ul>
<li>webpack’s Watch Mode</li>
<li>webpack-dev-server （还可以刷新浏览器， 实时重新加载）</li>
<li>webpack-dev-middleware（它可以把 webpack 处理过的文件发送到一个 server，可以自定义服务器）</li>
</ul>
</li>
<li>代码分离；把代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些文件。代码分离可以用于获取更小的 bundle，以及控制资源加载优先级，如果使用合理，会极大影响加载时间<ul>
<li>入口起点：使用 entry 配置手动地分离代码。</li>
<li>防止重复：使用 Entry dependencies 或者 SplitChunksPlugin 去重和分离 chunk。</li>
<li>动态导入：通过模块的内联函数调用来分离代码。</li>
</ul>
</li>
<li>缓存能力：通过必要的配置，以确保 webpack 编译生成的文件能够被客户端缓存，而在文件内容变化后，能够请求到新的文件。理想情况下的代码分离，最后分三类输出<ul>
<li>main.[contenthash].js 入口逻辑</li>
<li>runtime.[contenthash].js 运行时代码</li>
<li>vendors.[contenthash].js node_modules里的逻辑<br>vendors中的逻辑不会经常改变，因此可以利用缓存机制，减少向server请求资源。</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// 提供source map</span></span><br><span class="line">    <span class="attr">devtool</span>: <span class="string">&#x27;inline-source-map&#x27;</span>,</span><br><span class="line">    <span class="comment">// 提供本地实时更新server</span></span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">contentBase</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">        <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">inline</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Caching&#x27;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;[name].[contenthash].js&#x27;</span>,</span><br><span class="line">      <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">      <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="comment">// 保证vendor bundle不会随自身的module.id的变化而变化</span></span><br><span class="line">     <span class="attr">moduleIds</span>: <span class="string">&#x27;deterministic&#x27;</span>,</span><br><span class="line">     <span class="comment">// 将 runtime 代码拆分为一个单独的 chunk</span></span><br><span class="line">      <span class="attr">runtimeChunk</span>: <span class="string">&#x27;single&#x27;</span>,</span><br><span class="line">      <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="comment">// 将第三方库(library)（例如 lodash 或 react）提取到单独的 vendor chunk 文件中</span></span><br><span class="line">          <span class="attr">vendor</span>: &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">            name: <span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>


<h2 id="runtime-和-manifest"><a href="#runtime-和-manifest" class="headerlink" title="runtime 和 manifest"></a>runtime 和 manifest</h2><p>在使用 webpack 构建的典型应用程序或站点中，有三种主要的代码类型：</p>
<ul>
<li><p>你或你的团队编写的源码。</p>
</li>
<li><p>你的源码会依赖的任何第三方的 library 或 “vendor” 代码。</p>
</li>
<li><p>webpack 的 runtime 和 manifest，管理所有模块的交互。</p>
<h3 id="什么是runtime"><a href="#什么是runtime" class="headerlink" title="什么是runtime"></a>什么是runtime</h3></li>
</ul>
<p>runtime，以及伴随的 manifest 数据，主要是指：在浏览器运行过程中，webpack 用来连接模块化应用程序所需的所有代码。</p>
<p>它包含：在模块交互时，连接模块所需的加载和解析逻辑。包括：已经加载到浏览器中的连接模块逻辑，以及尚未加载模块的延迟加载逻辑。</p>
<h3 id="什么是manifest"><a href="#什么是manifest" class="headerlink" title="什么是manifest"></a>什么是manifest</h3><p>一旦你的应用在浏览器中以 index.html 文件的形式被打开，一些 bundle 和应用需要的各种资源都需要用某种方式被加载与链接起来。在经过打包、压缩、为延迟加载而拆分为细小的 chunk 这些 webpack 优化 之后，你精心安排的 /src 目录的文件结构都已经不再存在。所以 webpack 如何管理所有所需模块之间的交互呢？这就是 manifest 数据用途的由来……</p>
<p>当 compiler 开始执行、解析和映射应用程序时，它会保留所有模块的详细要点。这个数据集合称为 “manifest”，当完成打包并发送到浏览器时，runtime 会通过 manifest 来解析和加载模块。无论你选择哪种 模块语法，那些 import 或 require 语句现在都已经转换为 __webpack_require__ 方法，此方法指向模块标识符(module identifier)。通过使用 manifest 中的数据，runtime 将能够检索这些标识符，找出每个标识符背后对应的模块。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/10/26/%E5%88%9D%E8%AF%86webpack/" data-id="clpuo0yvg000dotmugjkhgcpv" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
    <article id="post-React Context从入门到实践" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h2 itemprop="name">
  <a class="article-title" href="/2021/07/13/React%20Context%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/">React Context从入门到实践</a>
</h2>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/07/13/React%20Context%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/" class="article-date">
  <time datetime="2021-07-13T09:50:43.000Z" itemprop="datePublished">2021-07-13</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
      <h2 id="Why-为什么要有React-Context"><a href="#Why-为什么要有React-Context" class="headerlink" title="Why-为什么要有React Context"></a>Why-为什么要有React Context</h2><h3 id="1-1-父子组件通信"><a href="#1-1-父子组件通信" class="headerlink" title="1.1 父子组件通信"></a>1.1 父子组件通信</h3><p>父传子：父组件通过props传递给子组件</p>
<p>子传父：父组件传递一个回调函数给子组件，子组件可以将需要传递给父组件的数据传入这个回调函数参数</p>
<h3 id="1-2-兄弟组件通信"><a href="#1-2-兄弟组件通信" class="headerlink" title="1.2 兄弟组件通信"></a>1.2 兄弟组件通信</h3><p>使用父组件作为桥梁，维护state变量，给兄弟组件传递props，兄弟组件修改父组件中的state</p>
<h3 id="1-3-层级较深的组件间通信"><a href="#1-3-层级较深的组件间通信" class="headerlink" title="1.3 层级较深的组件间通信"></a>1.3 层级较深的组件间通信</h3><p>(现有应用场景: 比如React Router组件、react-redux数据流管理)</p>
<p>使用Context API</p>
<p>官方定义: Context 提供了一个无需为每层组件手动添加 props，就能在组件树间进行数据传递的方法 </p>
<p>所以context设计的目的是为了共享对于一个组件树而言是”全局”的数据,例如当前登陆用户信息、主题、首选语言等等。</p>
<h2 id="What-怎么用React-Context"><a href="#What-怎么用React-Context" class="headerlink" title="What-怎么用React Context"></a>What-怎么用React Context</h2><h3 id="React-createContext"><a href="#React-createContext" class="headerlink" title="React.createContext"></a><code>React.createContext</code></h3><p>消费组件只有在组件树中没有找到匹配的Provider时, defaultValue的值才会生效(即使给Prodiver的value传undefined, defaultValue也不会生效)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ThemedButton = React.createContext(defaultValue);</span><br></pre></td></tr></table></figure>

<h3 id="Context-Provider"><a href="#Context-Provider" class="headerlink" title="Context.Provider"></a><code>Context.Provider</code></h3><ol>
<li>每个 Context 对象都会返回一个 Provider React 组件，它允许消费组件订阅 context 的变化</li>
<li>多个 Provider 也可以嵌套使用，里层的会覆盖外层的数据</li>
<li>当 Provider 的 value 值发生变化时(比较value值变化使用的是Object.is)，它内部的所有消费组件都会重新渲染(不受制于shouldComponentUpdate、React.PureComponent、React.memo、useMemo等)</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ThemedButton.Provider value=&#123;<span class="comment">/* 某个值 */</span>&#125;&gt;</span><br></pre></td></tr></table></figure>
<p>基于第3点,  我们传递给context值是复杂对象类型时,需要注意书写方式</p>
<h3 id="Class-contextType类中使用方式"><a href="#Class-contextType类中使用方式" class="headerlink" title="Class.contextType类中使用方式"></a><code>Class.contextType</code>类中使用方式</h3><p>给挂载在class上的contextType赋值一个context对象，就可以在类的任何生命周期中(除了constructor构造函数), 通过this.context访问到它的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemedButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="attr">context</span>: React.ContextType&lt;<span class="keyword">typeof</span> ThemeContext&gt;</span><br><span class="line">    <span class="keyword">static</span> contextType = ThemeContext <span class="comment">// 方式1</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;button(this.context)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">// 方式2</span></span><br><span class="line">ThemedButton.contextType = ThemeContext;</span><br></pre></td></tr></table></figure>

<h3 id="useContextHook中使用方式"><a href="#useContextHook中使用方式" class="headerlink" title="useContextHook中使用方式"></a><code>useContext</code>Hook中使用方式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = useContext(ThemeContext);</span><br></pre></td></tr></table></figure>

<h3 id="Context-Consumer"><a href="#Context-Consumer" class="headerlink" title="Context.Consumer"></a><code>Context.Consumer</code></h3><p>函数式和class中都可以使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemedButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      	<span class="comment">// 这里是使用了render props的方式,传递一个函数作为子组件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">ThemeContext.Consumer</span>&gt;</span>&#123;value =&gt;/* 基于Context值进行渲染*/&#125;<span class="tag">&lt;/<span class="name">ThemeContext.Consumer</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="How-如何实践React-Context"><a href="#How-如何实践React-Context" class="headerlink" title="How-如何实践React Context"></a>How-如何实践React Context</h2><h3 id="简单实现react-router-dom内容"><a href="#简单实现react-router-dom内容" class="headerlink" title="简单实现react-router-dom内容"></a>简单实现react-router-dom内容</h3><h4 id="1、react-router-dom的基本API和使用"><a href="#1、react-router-dom的基本API和使用" class="headerlink" title="1、react-router-dom的基本API和使用"></a>1、react-router-dom的基本API和使用</h4><p>首先我们简单回顾下</p>
<p>该模块包含两种路由, 分别是HashRouter和BrowserRouter, 其中HashRouter是采用hash值变化来切换路由, BrowserRouter是采用history API来切换路由</p>
<p>我们用HashRouter或者BrowserRouter包裹页面内容</p>
<p>在需要使用路由的地方,引入Route组件 (没有使用Route的组件或者页面,如果想拿到路由信息,可以使用withRouter包裹)</p>
<p>如果想显示切换链接, 就会用到Link组件 (也可以在任何能拿到路由信息的位置手动切换路由)</p>
<p>为了避免路径匹配时,会匹配到多个Route, 我们可以用Switch将一组Route包裹起来, 这样只会渲染匹配到的第一个Route</p>
<p>为了避免所有路径都无法匹配, 可以通过Redirect组件重定向到某个页面(比如空的兜底页面)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;HashRouter&gt;</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/paent&quot;</span>&gt;</span>redirect<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/parent&quot;</span>&gt;</span>Parent<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/comment&quot;</span>&gt;</span>Comment<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/study&quot;</span>&gt;</span>Study Context<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/countNum&quot;</span>&gt;</span>Count<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;AppPage&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/parent&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Parent&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/comment&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Comment&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/study&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Study&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/countNum&quot;</span> <span class="attr">component</span>=<span class="string">&#123;CountNum&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/parent&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"> &lt;/HashRouter&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2、实现基本原理"><a href="#2、实现基本原理" class="headerlink" title="2、实现基本原理"></a>2、实现基本原理</h4><p>利用Context API ,通过将context对象注入到Router组件(HashRouter或者BrowserRouter)中, Router组件的render()返回的渲染内容就是该context对象的Provider组件,value值就是当前路由信息对象, 里面渲染props.children内容.</p>
<p>也就是只要被它包围的子组件,都有机会获取到当前路由信息. 比如Router组件下面的Switch、Route、 Link、 Redirect等, 他们获取到之后可以改变当前路由信息, 从而实现动态切换Route组件的渲染</p>
<p>下面我们实现一个简单版本的react-router-dom</p>
<p><strong>导出context对象,保存全局路由信息</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// context.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> topContext = React.createContext(&#123;&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> topContext;</span><br></pre></td></tr></table></figure>

<p><strong>实现HashRouter</strong></p>
<p>在react中，当前路由信息对象包含了location、match、history三个对象，为了方便操作，我们将location和match对象定义到state中，因为这两个对象中的数据是需要在Router内部动态修改的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HashRouter.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">&quot;./context&quot;</span>; <span class="comment">// 引入上下文对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">HashRouter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 在HashRouter中新增构造函数，并且将location和match定义到state对象中</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.state = &#123; <span class="comment">// 为了方便更改当前路由信息，将location和match放到state中</span></span><br><span class="line">            <span class="attr">location</span>: &#123;</span><br><span class="line">                <span class="attr">pathname</span>: <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>) || <span class="string">&quot;/&quot;</span>, <span class="comment">// 获取浏览器地址栏中的hash值，如果不存在则默认为&quot;/&quot;</span></span><br><span class="line">                <span class="attr">query</span>: <span class="literal">undefined</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">match</span>: &#123;</span><br><span class="line">                <span class="attr">params</span>: <span class="literal">undefined</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 子组件调用history.push方法更新location</span></span><br><span class="line">        <span class="comment">// 监听hash值变化,更新全局location对象, HashRouter下面的子组件Route就会重新渲染</span></span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">&quot;hashchange&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">                <span class="attr">location</span>: &#123;</span><br><span class="line">                    ...this.state.location,</span><br><span class="line">                    <span class="attr">pathname</span>: <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 当前路由对象</span></span><br><span class="line">        <span class="keyword">const</span> currentRoute = &#123;</span><br><span class="line">            <span class="attr">location</span>: <span class="built_in">this</span>.state.location,</span><br><span class="line">            <span class="attr">match</span>: <span class="built_in">this</span>.state.match,</span><br><span class="line">            <span class="comment">// 新增一个history对象用于实现当前路由的切换</span></span><br><span class="line">            <span class="attr">history</span>: &#123;</span><br><span class="line">                <span class="attr">push</span>: <span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> to === <span class="string">&quot;object&quot;</span>) &#123; <span class="comment">// 如果to是一个对象</span></span><br><span class="line">                        <span class="keyword">let</span> &#123; pathname, query &#125; = to; <span class="comment">// 取出pathname和query, react中还有search、state等参数，这里只以query为例。</span></span><br><span class="line">                        <span class="built_in">window</span>.location.hash = pathname; <span class="comment">// 更新浏览器hash值，触发浏览器hashchange事件</span></span><br><span class="line">                       <span class="comment">// this.state.location.pathname = pathname;</span></span><br><span class="line">                        <span class="built_in">this</span>.state.location.query = query; <span class="comment">// 更新query</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">window</span>.location.hash = to; <span class="comment">// 更新浏览器hash值</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  <span class="comment">// 这部分只是修改了浏览器的地址栏,要想Router组件以及子组件重新渲染,还得通过监听hashchange事件, 调用setState实现</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="comment">// 使用上下文对象提供的Provider组件将当前路由信息对象注入上下文中，以便其Route等子组件能够获取到当前路由信息</span></span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;currentRoute&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;this.props.children&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实现Route组件</strong></p>
<p>Route组件主要做的事,从context对象中拿到当前路由信息,跟传入的path参数进行对比,如果相同或者匹配, 则渲染出Route组件上配置的component内容,否则返回null</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Route.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> context <span class="keyword">from</span> <span class="string">&quot;./context&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Route</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> currentRoutePath = <span class="built_in">this</span>.context.location.pathname; <span class="comment">// 从上下文中获取到当前路由的路径</span></span><br><span class="line">        <span class="keyword">const</span> &#123;path, <span class="attr">component</span>:MyComponent&#125; = <span class="built_in">this</span>.props; <span class="comment">// 获取给Route组件传递的props属性</span></span><br><span class="line">        <span class="keyword">const</span> comProps = &#123;</span><br><span class="line">            ...this.context</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (currentRoutePath === path) &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> &#123;<span class="attr">...comProps</span>&#125; /&gt;</span></span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 必须有返回值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Route.contextType = Context;</span><br></pre></td></tr></table></figure>

<p>支持带冒号的参数路径、支持exact, 主要用到了<a target="_blank" rel="noopener" href="https://github.com/pillarjs/path-to-regexp">path-to-regexp</a>模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Route.jsx</span></span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">&quot;./context&quot;</span>; <span class="comment">// 引入上下文对象</span></span><br><span class="line"><span class="comment">// match方法可以拿到匹配的params，pathToRegexp可以检测路径是否匹配成功</span></span><br><span class="line"><span class="keyword">import</span> &#123; pathToRegexp, match &#125; <span class="keyword">from</span> <span class="string">&quot;path-to-regexp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Route</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取当前路由path</span></span><br><span class="line">        <span class="keyword">const</span> currentRoutePath = <span class="built_in">this</span>.context.location.pathname;</span><br><span class="line">        <span class="keyword">const</span> &#123;path, <span class="attr">component</span>: MyComponent, exact = <span class="literal">false</span>, render&#125; = <span class="built_in">this</span>.props;</span><br><span class="line">        <span class="comment">// 针对复杂,带参数路由</span></span><br><span class="line">        <span class="keyword">const</span> genParamsObjFun = match(path, &#123;<span class="attr">end</span>: exact&#125;); <span class="comment">// 生成正则校验函数</span></span><br><span class="line">        <span class="keyword">const</span> paramsRes = genParamsObjFun(currentRoutePath);</span><br><span class="line">        <span class="comment">// 将匹配的参数 赋值 给全局match对象的params</span></span><br><span class="line">        <span class="built_in">this</span>.context.match.params = paramsRes.params;</span><br><span class="line">        <span class="keyword">const</span> comProps = &#123;</span><br><span class="line">            ...this.context,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 生成匹配path的正则表达式</span></span><br><span class="line">        <span class="keyword">const</span> pathReg = pathToRegexp(path, [], &#123;<span class="attr">end</span>: exact&#125;);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;pathmatch&#x27;</span>, pathReg.test(currentRoutePath), path, currentRoutePath);</span><br><span class="line">        <span class="keyword">if</span> (pathReg.test(currentRoutePath)) &#123;</span><br><span class="line">            <span class="keyword">return</span> render ? render() : <span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> &#123;<span class="attr">...comProps</span>&#125; /&gt;</span></span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Route.contextType = Context;</span><br></pre></td></tr></table></figure>

<p><strong>实现Link组件</strong></p>
<p>本质上就是a标签,当点击时修改全局路由信息, 通过history.push修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Link.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> context <span class="keyword">from</span> <span class="string">&quot;./context&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Link</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; to &#125; = <span class="built_in">this</span>.props; <span class="comment">// 从Link组件上获取到配置的to路径</span></span><br><span class="line">        <span class="comment">// 点击Link的时候调用当前路由的history的push方法进行跳转即可</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="xml">            this.context.history.push(to);</span></span><br><span class="line"><span class="xml">          &#125;&#125;&gt;&#123;this.props.children&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Link.contextType = context;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>实现Redirect组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redirect.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> context <span class="keyword">from</span> <span class="string">&quot;./context&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Redirect</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 直接重定向跳转到指定的路径</span></span><br><span class="line">        <span class="built_in">this</span>.context.history.push(<span class="built_in">this</span>.props.to);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Redirect.contextType = context;</span><br></pre></td></tr></table></figure>
<p><strong>实现Switch组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> context <span class="keyword">from</span> <span class="string">&quot;./context&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; pathToRegexp &#125; <span class="keyword">from</span> <span class="string">&quot;path-to-regexp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Switch</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// static contextType = context;</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> children = <span class="built_in">Array</span>.isArray(<span class="built_in">this</span>.props.children) ? <span class="built_in">this</span>.props.children : [<span class="built_in">this</span>.props.children];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.length; i++) &#123; <span class="comment">// 遍历Switch组件下的所有子组件</span></span><br><span class="line">            <span class="keyword">const</span> child = children[i];</span><br><span class="line">            <span class="keyword">const</span> &#123; path = <span class="string">&quot;/&quot;</span>, exact = <span class="literal">false</span> &#125; = child.props;</span><br><span class="line">            <span class="keyword">const</span> &#123; pathname &#125; = <span class="built_in">this</span>.context.location;</span><br><span class="line">            <span class="keyword">const</span> regexp = pathToRegexp(path, [], &#123; <span class="attr">end</span>: exact &#125;);</span><br><span class="line">            <span class="keyword">if</span> (regexp.test(pathname)) &#123; <span class="comment">// 如果匹配成功则立即返回作为&lt;Switch&gt;组件的渲染结果</span></span><br><span class="line">                <span class="keyword">return</span> child;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Switch.contextType = context;</span><br></pre></td></tr></table></figure>

<p><strong>实现BrowserRouter组件</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">&quot;./context&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">BrowserRouter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            <span class="attr">location</span>: &#123;</span><br><span class="line">                <span class="attr">pathname</span>: <span class="built_in">window</span>.location.pathname || <span class="string">&quot;/&quot;</span>,</span><br><span class="line">                <span class="attr">query</span>: <span class="literal">undefined</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">match</span>: &#123;</span><br><span class="line">                <span class="attr">params</span>: <span class="literal">undefined</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">&quot;popstate&quot;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 监听浏览器前进后退按钮</span></span><br><span class="line">            <span class="built_in">this</span>.setState(&#123; <span class="comment">// 触发页面更新</span></span><br><span class="line">                <span class="attr">location</span>: &#123;</span><br><span class="line">                    <span class="attr">pathname</span>: <span class="built_in">window</span>.location.pathname <span class="comment">// 路径变化后更新当前路由对应的pathname</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> currentRoute = &#123; </span><br><span class="line">            <span class="attr">location</span>: <span class="built_in">this</span>.state.location,</span><br><span class="line">            <span class="attr">match</span>: <span class="built_in">this</span>.state.match,</span><br><span class="line">            <span class="attr">history</span>: &#123; <span class="comment">// 新增一个history对象用于实现当前路由的切换</span></span><br><span class="line">                <span class="attr">push</span>: <span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> to === <span class="string">&quot;object&quot;</span>) &#123; <span class="comment">// 如果to是一个对象</span></span><br><span class="line">                        <span class="keyword">let</span> &#123;pathname, query&#125; = to; <span class="comment">// 取出pathname和query</span></span><br><span class="line">                        <span class="built_in">this</span>.state.location.query = query; <span class="comment">// 更新query</span></span><br><span class="line">                        <span class="built_in">this</span>.state.location.pathname = pathname;<span class="comment">// 更新当前路由对应的pathname</span></span><br><span class="line">                        <span class="built_in">window</span>.history.pushState(&#123;&#125;, <span class="string">&quot;&quot;</span>, pathname); <span class="comment">// 添加一条history</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果to是一个路径字符串</span></span><br><span class="line">                        <span class="built_in">this</span>.state.location.pathname = to; <span class="comment">// 更新当前路由对应的pathname</span></span><br><span class="line">                        <span class="built_in">window</span>.history.pushState(&#123;&#125;, <span class="string">&quot;&quot;</span>, to); <span class="comment">// 添加一条history</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">this</span>.setState(&#123;&#125;); <span class="comment">// 触发页面更新</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="comment">// 使用上下文提供的Provider组件将当前路由信息对象注入上下文中，以便其Route子组件能够获取到当前路由信息</span></span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;currentRoute&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;this.props.children&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后,将所有内容统一导出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HashRouter <span class="keyword">from</span> <span class="string">&quot;./HashRouter.jsx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> BrowserRouter <span class="keyword">from</span> <span class="string">&quot;./BrowserRouter.jsx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">&quot;./Link.jsx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Route <span class="keyword">from</span> <span class="string">&quot;./Route.jsx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Redirect <span class="keyword">from</span> <span class="string">&quot;./Redirect.jsx&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Switch <span class="keyword">from</span> <span class="string">&quot;./Switch.jsx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    HashRouter,</span><br><span class="line">    BrowserRouter,</span><br><span class="line">    Link,</span><br><span class="line">    Route,</span><br><span class="line">    Redirect,</span><br><span class="line">    Switch,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="简单实现react-redux内容"><a href="#简单实现react-redux内容" class="headerlink" title="简单实现react-redux内容"></a>简单实现react-redux内容</h3><h4 id="1、-react-redux基本功能"><a href="#1、-react-redux基本功能" class="headerlink" title="1、 react-redux基本功能"></a>1、 react-redux基本功能</h4><p>首先回顾下react-redux解决了什么问题, 当我们的某些数据,需要在多个页面,多个组件间共享时, 而且这些组件跨层级, 这个时候就需要用到react-redux提供的公共状态管理功能,并且当数据有更新的时候,所有用到的组件都能及时监听到变化.</p>
<p>页面最外层会包裹一个Provider组件,没错这个就是提供全局context用的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Provider store=&#123;dva._store&#125;&gt;</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Router</span> /&gt;</span></span></span><br><span class="line"> &lt;/Provider&gt;</span><br></pre></td></tr></table></figure>

<p>_store对象提供我们定义好的model</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">    <span class="attr">selectedOrgId</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type State = <span class="keyword">typeof</span> defaultState;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ListModel: Dva.Model = &#123;</span><br><span class="line">    <span class="attr">namespace</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        ...defaultState,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">effects</span>: &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line">        <span class="function"><span class="title">setOrg</span>(<span class="params">state: State, &#123; payload &#125;: any</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">selectedOrgId</span>: payload + <span class="number">1</span> &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ListModel;</span><br></pre></td></tr></table></figure>

<p>需要使用这些公共状态的地方会用connect高阶函数调用, 分别传递两个函数, 这两个函数都返回对象类型值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">&#123; list &#125;: any</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...list,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch: any</span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">setOrgID</span>: <span class="function">(<span class="params">payload: any</span>) =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;list/setOrg&#x27;</span>, payload &#125;),</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Parent);</span><br></pre></td></tr></table></figure>

<h4 id="2、实现基本原理-1"><a href="#2、实现基本原理-1" class="headerlink" title="2、实现基本原理"></a>2、实现基本原理</h4><p>要想实现这样的共享的数据，首先想到的必是建一个全局模块，里面存放很多公共的数据。就像这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当状态改变的时候,直接赋值操作不好,容易误操作影响到其他组件, 并且不易排查错误</p>
<p>既然是共享数据，外部又不能直接改变它，当然就是一个闭包啦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">initialState, reducer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> currentState = initialState || &#123;&#125;</span><br><span class="line">    <span class="comment">// 存放观察者的队列</span></span><br><span class="line">    <span class="keyword">let</span> observers = []</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> currentState;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">        currentState = reducer(currentState, action)</span><br><span class="line">        <span class="comment">// 每次currentState改变, 重新执行观察者队列内容,更新视图</span></span><br><span class="line">        observers.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn());</span><br><span class="line">    &#125;</span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="string">&#x27;@@REDUX_INIT&#x27;</span> &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">        observers.push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getState,</span><br><span class="line">        dispatch,</span><br><span class="line">        subscribe,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、手动实现过程"><a href="#3、手动实现过程" class="headerlink" title="3、手动实现过程"></a>3、手动实现过程</h4><p>实现Provider组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;React&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">&#x27;./context.jsx&#x27;</span>;</span><br><span class="line"><span class="comment">// import store from &#x27;./createStore.jsx&#x27;;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.props.store);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.props.store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;this.props.children&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现connect组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;React&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallowEqual &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> context <span class="keyword">from</span> <span class="string">&#x27;./context.jsx&#x27;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params">mapStateToProps, mapDispatchToProps</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Connect</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">            <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>(props);</span><br><span class="line">                <span class="built_in">this</span>.state = &#123;</span><br><span class="line">                    <span class="attr">storeState</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">mapDispatch</span>: <span class="literal">null</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> store = <span class="built_in">this</span>.context;</span><br><span class="line">                <span class="keyword">const</span> &#123; storeState &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">                <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">                    <span class="attr">storeState</span>: mapStateToProps(<span class="built_in">this</span>.context.getState()),</span><br><span class="line">                    <span class="attr">mapDispatch</span>: mapDispatchToProps(<span class="built_in">this</span>.context.dispatch)</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// 如果store中的状态改变,就会执行这个回调函数,此时获取新的state和旧的做对比,如果变化了,就setState</span></span><br><span class="line">                store.subscribe(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> mappedState = mapStateToProps(store.getState());</span><br><span class="line">                    <span class="keyword">if</span> (shallowEqual(storeState, mappedState)) &#123;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">                            <span class="attr">storeState</span>: mappedState,</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> &#123; storeState, mapDispatch &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; &#123;<span class="attr">...storeState</span>&#125; &#123;<span class="attr">...mapDispatch</span>&#125; /&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Connect.contextType = context;</span><br><span class="line">        <span class="keyword">return</span> Connect</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/07/13/React%20Context%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/" data-id="clpuo0yva0006otmue9if0sqa" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next</a>
  </nav>
  
</section>
</div>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-bar-chart"></i> <span id="busuanzi_value_site_pv"></span></li>
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>Hexo &copy; 2023</li>
      
        <li>quhandong</li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <!-- <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li> -->
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="Hexo"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.douyin.com/user/MS4wLjABAAAA4EevfdHrS1s-urfPJWWJEs-_c_qLu19jtr-eYdpBNBk?enter_from=main_page&enter_method=top_bar">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2022/07/01/README/">About</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>






<script src="/js/ocean.js"></script>

</body>

</html>